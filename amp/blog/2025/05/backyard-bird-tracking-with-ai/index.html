<!doctype html>
<html amp lang="en">



  <meta charset="utf-8">
  <title>Backyard Bird Tracking With AI-Powered BirdNET-Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#3d256d">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#3d256d">

  <!-- Contain all special checks needed on AMP pages. Attempt to consolidate checks. -->


  
  <!-- Extract extra <title> tag. -->
  
  
  
  

  
  
  
  

  
    <!-- Assumes AmpDir is always first instance in page.url based on how amp-jekyll builds it -->
    
    

    <!-- Begin Jekyll SEO tag v2.8.0 -->

<meta name="generator" content="Jekyll v4.4.1">

<meta name="author" content="Kyle Niewiada">
<meta property="og:locale" content="en_US">
<meta name="description" content="Turning security cameras into AI bird detectives! How I use BirdNET-Go &amp; Home Assistant for 24/7 bird detections &amp; alerts. Identify every chirp!">
<meta property="og:description" content="Turning security cameras into AI bird detectives! How I use BirdNET-Go &amp; Home Assistant for 24/7 bird detections &amp; alerts. Identify every chirp!">
<link rel="canonical" href="/blog/2025/05/backyard-bird-tracking-with-ai/">
<meta property="og:url" content="/blog/2025/05/backyard-bird-tracking-with-ai/">
<meta property="og:site_name" content="Kyle Niewiada’s Website">
<meta property="og:image" content="https://www.kyleniewiada.org/assets/img/2025/05/birdwatching_0.jpg">
<meta property="og:image:height" content="600">
<meta property="og:image:width" content="800">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-05-26T21:58:00-04:00">
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://www.kyleniewiada.org/assets/img/2025/05/birdwatching_0.jpg">
<meta property="twitter:title" content="Backyard Bird Tracking With AI-Powered BirdNET-Go">
<meta name="twitter:site" content="@CrypticCitrus">
<meta name="twitter:creator" content="@CrypticCitrus">
<meta property="fb:app_id" content="137961485759">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kyle Niewiada"},"dateModified":"2025-05-26T21:58:00-04:00","datePublished":"2025-05-26T21:58:00-04:00","description":"Turning security cameras into AI bird detectives! How I use BirdNET-Go &amp; Home Assistant for 24/7 bird detections &amp; alerts. Identify every chirp!","headline":"Backyard Bird Tracking With AI-Powered BirdNET-Go","image":{"height":600,"width":800,"url":"https://www.kyleniewiada.org/assets/img/2025/05/birdwatching_0.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/2025/05/backyard-bird-tracking-with-ai/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://www.kyleniewiada.org/assets/img/logo.png"},"name":"Kyle Niewiada"},"url":"/blog/2025/05/backyard-bird-tracking-with-ai/"}</script>
<!-- End Jekyll SEO tag -->

  



  <style amp-custom>
  
  @font-face{font-family:"Open Sans";font-display:swap;font-style:normal;font-weight:300;src:local("Open Sans Light"),local("OpenSans-Light"),url("/assets/fonts/open-sans-v17-latin-300.woff2") format("woff2"),url("/assets/fonts/open-sans-v17-latin-300.woff") format("woff")}@font-face{font-family:"Open Sans";font-display:swap;font-style:normal;font-weight:400;src:local("Open Sans"),local("OpenSans"),url("/assets/fonts/open-sans-v17-latin-regular.woff2") format("woff2"),url("/assets/fonts/open-sans-v17-latin-regular.woff") format("woff")}@font-face{font-family:"Open Sans";font-display:swap;font-style:normal;font-weight:600;src:local("Open Sans Semibold"),local("OpenSans-Semibold"),url("/assets/fonts/open-sans-v17-latin-600.woff2") format("woff2"),url("/assets/fonts/open-sans-v17-latin-600.woff") format("woff")}.page-title{text-align:left;font-size:200%;line-height:1.2;font-weight:normal}@media(min-width: 600px){.page-title{font-size:250%}}@media(min-width: 1000px){.page-title{font-size:300%}}.meta{color:dimgray;font-weight:300;font-size:120%}@media(min-width: 600px){.meta{font-size:130%}}@media(min-width: 1000px){.meta{font-size:140%}}.sub-meta{color:dimgray;font-weight:300;font-size:100%}@media(min-width: 600px){.sub-meta{font-size:110%}}@media(min-width: 1000px){.sub-meta{font-size:120%}}a.meta{text-align:center;display:block}.title-meta{overflow:auto;color:dimgray;font-size:100%}h1,.h1,h2,.h2,h3,.h3,h4,.h4,h5,.h5,h6,.h6{margin:0 0 .5rem;font-weight:600}a{color:#3d256d}a:hover{color:hsl(260,49.3150684932%,13.6274509804%)}code,pre{border-radius:.2em;background-color:#f5f5f5;border:.1em solid #d3d3d3}code{padding:2px 4px;color:#902f74}pre{padding:16px;overflow-y:hidden}pre code{color:inherit;background-color:rgba(0,0,0,0);padding:0;border:0}h1 .octicon,h2 .octicon,h3 .octicon,h4 .octicon,h5 .octicon,h6 .octicon{visibility:hidden}h1:hover .octicon,h2:hover .octicon,h3:hover .octicon,h4:hover .octicon,h5:hover .octicon,h6:hover .octicon{visibility:visible}.octicon{fill:currentColor;padding:0;vertical-align:middle}body{margin:0}body,p,li,ul,input,textarea{font-size:1em;line-height:1.58;color:#111;font-family:"Open Sans",Helvetica,Arial,sans-serif;overflow-wrap:break-word}img,video,audio,iframe,object{max-width:100%}main{display:block}.line-separator{height:2px;background:#d3d3d3;margin-top:16px;margin-bottom:16px}.clearfix:after{content:"";display:block;clear:both}.content{max-width:700px;margin-right:auto;margin-left:auto;padding:0 16px}.content img{display:block;margin-left:auto;margin-right:auto}.content video{display:block;margin-left:auto;margin-right:auto}.no-list{list-style:none;padding-left:0;margin-left:0}.left{float:left}.right{float:right}.post-list li{margin-bottom:4em;position:relative}.post-list li:before{content:"";position:absolute;bottom:-2em;left:0;background:hsl(0,0%,90%);height:2px;width:60px}.post-list li a{text-decoration:none}.post-list li a:hover{text-decoration:underline}.post-list li .date{color:dimgray;font-size:.8em}.header-amp{background:#262626;margin-bottom:16px;padding:16px;text-align:center;font-size:1.4em;font-weight:normal}.header-amp a,.header-amp a:hover{color:#fff;text-decoration:none;overflow:visible}

  

  
  footer{padding:16px 0}footer .flex-list{position:relative;margin:1em;overflow:hidden;border-top:1px solid #d3d3d3}footer .flex-list ul{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;margin-left:-1px;padding:0}footer .flex-list li{list-style:none;flex-grow:1;flex-basis:auto;margin:.25em 0;padding:0 1em;text-align:center;border-left:1px solid #ccc;background-color:#fff}@media(min-width: 600px){footer .flex-list li{font-size:110%}}footer a{text-decoration:none}footer a:hover{background:#3d256d;color:#fff}article img+em,article amp-img+em,article video+em{text-align:center;font-size:.9em;font-style:italic;color:rgb(93.5,93.5,93.5);display:block}article img+p,article amp-img+p{margin-bottom:2em}blockquote{background:#ffa;border-left:10px solid #dc0;margin:1.5em 10px;padding:.5em 10px}.post-nav{display:flex;flex-direction:column}.post-nav .post-nav-link{height:6em;margin:.1em;overflow:hidden;position:relative}.post-nav .post-nav-link .link-text{z-index:1;position:absolute;height:100%;width:100%;box-sizing:border-box;padding:.5em;font-weight:bold;color:#fff;background:rgba(0,0,0,.6)}.post-nav .post-nav-link .previous{text-align:left}.post-nav .post-nav-link .next{text-align:right}.post-nav .post-nav-link .link-image{position:absolute;filter:blur(1px);transition:all .35s ease-in-out;top:50%;transform:translateY(-50%);width:auto;height:auto;min-width:100%;min-height:100%}.post-nav .post-nav-link:hover img{transform:translateY(-50%) scale(1.2)}@media all and (min-width: 600px){.post-nav{flex-direction:row}.post-nav .post-nav-link{flex-basis:0;flex-grow:1}}.button-outline{line-height:1.2em;padding:.5em 1.5em;border-radius:4px;text-decoration:none;cursor:pointer}.button-outline{background-color:rgba(0,0,0,0);border:3px solid #3d256d;color:#3d256d}.button-outline:hover{background-color:#3d256d;color:#fff}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:teal}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}details:not([open]) summary{border-radius:5px}details[open]{border-color:#bce5ff;border-bottom-style:solid;border-left-style:solid;border-right-style:solid}details[open] p{margin-left:16px;margin-right:16px}details[open] summary::after{transform:rotate(-180deg)}details{margin-top:16px;margin-bottom:16px}details summary{background-color:#bce5ff;list-style:none;color:#111;padding:16px;display:flex;justify-content:space-between;align-items:center}details summary::after{content:"";width:0;height:0;border-top:10px solid #111;border-inline:7px solid rgba(0,0,0,0);transition:.2s}details summary::-webkit-details-marker{display:none}details div:first-child{border-radius:0 0 5px 5px;border:.2em solid #e5e5e5}details pre:first-child{margin:0px;border-radius:0 0 .2em .2em}
  </style>

  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>

  <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
  <script async src="https://cdn.ampproject.org/v0.js"></script>
  
    <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
  
  



<body>
 <!-- https://github.com/analytics-debugger/google-analytics-4-for-amp -->
<amp-analytics type="googleanalytics" config="https://www.kyleniewiada.org/assets/ga4.json" data-credentials="include">
  <script type="application/json">
  {
      "vars": {
                  "GA4_MEASUREMENT_ID": "G-ZP46JK222K",
                  "GA4_ENDPOINT_HOSTNAME": "www.google-analytics.com",
                  "DEFAULT_PAGEVIEW_ENABLED": true,    
                  "GOOGLE_CONSENT_ENABLED": false,
                  "WEBVITALS_TRACKING": false,
                  "PERFORMANCE_TIMING_TRACKING": false,
                  "SEND_DOUBLECLICK_BEACON": false
      }
  }
  </script>
</amp-analytics>



<!-- start header -->
<header>
  <h1 class="header-amp">
    <a href="/">Kyle Niewiada</a>
  </h1>
</header>
<!-- end header -->



<main class="content">
  <article>
    <div class="post_info">
      <h1 class="page-title">Backyard Bird Tracking With AI-Powered BirdNET-Go</h1>

      <h2 class="meta">Kyle Niewiada

      <h3 class="meta">May 26, 2025 | 
        
          31 Minute Read
        
      </h3>

      
      <h4 class="sub-meta">Updated on October 16, 2025</h4>
        

      
      <div class="featuredImage">
        <amp-img src="/assets/img/2025/05/birdwatching_0.jpg" alt="Kyle looking through binoculars for birds at a lake on an early fall morning" width="800" height="603" layout="responsive"><noscript><img src="/assets/img/2025/05/birdwatching_0.jpg" alt="Kyle looking through binoculars for birds at a lake on an early fall morning" width="800" height="603"></noscript></amp-img>
      </div>
      

      <div class="line-separator"></div>

    </h2>
</div>

    <p>How many different birds do you think visit your house each day? How many do you hear on your walks? Are there birds you remember hearing as a kid, but you couldn’t remember how to identify them?</p>

<p>Back in early 2023, some of my friends introduced me to the board game, <a href="https://boardgamegeek.com/boardgame/266192/wingspan">Wingspan</a>. Before that, I hadn’t thought about the diversity of bird species around me. Sure, I thought it was cool to see an owl or a hawk fly over. Occasionally I would use my phone to ID a bird sound. But I never dwelled on those thoughts for more than a few minutes.</p>

<p>If you’re unfamiliar, Wingspan is a resource management turn-based game. It heavily involves synergy between different bird species and their traits. It includes cards that contain information about a variety of bird species. Seriously, did you realize how many different species there are??</p>

<p>This awakened a new interest in me and I was hooked 🪝. I started to pay attention to the birds around me and was identifying bird sounds more frequently with the <a href="https://merlin.allaboutbirds.org/">Merlin app</a> on my phone (highly recommended).</p>

<p>There was an itch I wanted to scratch though. What if I were able to detect birds around my house <em>all of the time</em>?</p>

<blockquote>
  <p>Are you only here for the BirdNET-Go Home Assistant sensors and cards? Skip ahead to the <a href="#home-assistant-sensors">Home Assistant Sensors</a> or the <a href="#home-assistant-cards">Home Assistant Cards</a> sections below.</p>
</blockquote>

<div class="line-separator"></div>
<h2>Table of Contents</h2>
<div class="table-of-contents">
<ul id="markdown-toc">
  <li><a href="#changelog" id="markdown-toc-changelog">Changelog</a></li>
  <li><a href="#continuous-bird-detection" id="markdown-toc-continuous-bird-detection">Continuous Bird Detection</a></li>
  <li><a href="#the-perfect-solution-birdnet-go" id="markdown-toc-the-perfect-solution-birdnet-go">The Perfect Solution: BirdNET-Go</a></li>
  <li>
<a href="#did-it-work" id="markdown-toc-did-it-work">Did It Work?</a>    <ul>
      <li><a href="#tweak-camera-audio-settings" id="markdown-toc-tweak-camera-audio-settings">Tweak Camera Audio Settings</a></li>
      <li><a href="#wind-noise" id="markdown-toc-wind-noise">Wind Noise</a></li>
    </ul>
  </li>
  <li>
<a href="#birdnet-go-usage" id="markdown-toc-birdnet-go-usage">BirdNET-Go Usage</a>    <ul>
      <li><a href="#educational" id="markdown-toc-educational">Educational</a></li>
      <li><a href="#tracking" id="markdown-toc-tracking">Tracking</a></li>
    </ul>
  </li>
  <li>
<a href="#home-assistant-sensors" id="markdown-toc-home-assistant-sensors">Home Assistant Sensors</a>    <ul>
      <li><a href="#sensor-for-daily-species-summary" id="markdown-toc-sensor-for-daily-species-summary">Sensor for Daily Species Summary</a></li>
      <li><a href="#sensor-for-overall-species-summary" id="markdown-toc-sensor-for-overall-species-summary">Sensor for Overall Species Summary</a></li>
      <li>
<a href="#notes" id="markdown-toc-notes">Notes</a>        <ul>
          <li><a href="#recorder" id="markdown-toc-recorder">Recorder</a></li>
          <li><a href="#faster-responsiveness" id="markdown-toc-faster-responsiveness">Faster Responsiveness</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<a href="#home-assistant-cards" id="markdown-toc-home-assistant-cards">Home Assistant Cards</a>    <ul>
      <li><a href="#card-daily-species-summary-with-sparklines" id="markdown-toc-card-daily-species-summary-with-sparklines">Card: Daily Species Summary With Sparklines</a></li>
      <li><a href="#card-latest-species-detections" id="markdown-toc-card-latest-species-detections">Card: Latest Species Detections</a></li>
      <li><a href="#card-birds-of-interest" id="markdown-toc-card-birds-of-interest">Card: Birds of Interest</a></li>
      <li><a href="#card-brand-new-detections" id="markdown-toc-card-brand-new-detections">Card: Brand New Detections</a></li>
    </ul>
  </li>
  <li>
<a href="#notifications" id="markdown-toc-notifications">Notifications</a>    <ul>
      <li>
<a href="#notify-for-custom-species-detection" id="markdown-toc-notify-for-custom-species-detection">Notify for Custom Species Detection</a>        <ul>
          <li><a href="#custom-action-in-birdnet-go" id="markdown-toc-custom-action-in-birdnet-go">Custom Action in BirdNET-Go</a></li>
          <li><a href="#notification-for-a-bird-triggered-by-birdnet-go-script" id="markdown-toc-notification-for-a-bird-triggered-by-birdnet-go-script">Notification: For A Bird Triggered by BirdNET-Go Script</a></li>
        </ul>
      </li>
      <li><a href="#notify-for-a-bird-species-never-detected-before" id="markdown-toc-notify-for-a-bird-species-never-detected-before">Notify for a Bird Species Never Detected Before</a></li>
      <li><a href="#notify-for-a-bird-that-hasnt-been-detected-in-a-while" id="markdown-toc-notify-for-a-bird-that-hasnt-been-detected-in-a-while">Notify for a Bird That Hasn’t Been Detected in a While</a></li>
    </ul>
  </li>
  <li>
<a href="#bonus-generate-shareable-videos-from-sound-detections" id="markdown-toc-bonus-generate-shareable-videos-from-sound-detections">Bonus: Generate Shareable Videos From Sound Detections</a>    <ul>
      <li><a href="#new-search-dashboard-audio-files" id="markdown-toc-new-search-dashboard-audio-files">New Search Dashboard Audio Files</a></li>
      <li><a href="#legacy-search-dashboard-audio-files" id="markdown-toc-legacy-search-dashboard-audio-files">Legacy Search Dashboard Audio Files</a></li>
    </ul>
  </li>
  <li>
<a href="#favorite-bird-recordings" id="markdown-toc-favorite-bird-recordings">Favorite Bird Recordings</a>    <ul>
      <li><a href="#white-crowned-sparrow-" id="markdown-toc-white-crowned-sparrow-">White-crowned Sparrow 🔊</a></li>
      <li><a href="#ruby-throated-hummingbird-" id="markdown-toc-ruby-throated-hummingbird-">Ruby-throated Hummingbird 🔊</a></li>
      <li><a href="#black-throated-green-warbler-" id="markdown-toc-black-throated-green-warbler-">Black-throated Green Warbler 🔊</a></li>
      <li><a href="#red-tailed-hawk-" id="markdown-toc-red-tailed-hawk-">Red-tailed Hawk 🔊</a></li>
      <li><a href="#osprey-duet-" id="markdown-toc-osprey-duet-">Osprey Duet 🔊</a></li>
    </ul>
  </li>
  <li><a href="#cool-encounters" id="markdown-toc-cool-encounters">Cool Encounters</a></li>
  <li><a href="#future-plans" id="markdown-toc-future-plans">Future Plans</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

</div>
<div class="line-separator"></div>

<h2 id="changelog">Changelog</h2>

<blockquote>
  <p>Changelog:</p>
  <ul>
    <li>2025-06-04: Tweaked the <code class="language-plaintext highlighter-rouge">command_line</code> sensors to use <code class="language-plaintext highlighter-rouge">curl</code> retry logic for fewer Home Assistant warning logs.</li>
    <li>2025-07-09: Tweaked the <code class="language-plaintext highlighter-rouge">notify</code> conditions to filter out an <code class="language-plaintext highlighter-rouge">unavailable</code> <code class="language-plaintext highlighter-rouge">from_state</code> which could occur when manually reloading all template entities in Home Assistant.</li>
    <li>2025-08-28: Tweaked the “rare species” automation to skip sending an alert when the species list changes. This avoids an issue where timestamps are sometimes wrong when a new species is added to the list by the BirdNET-Go API.</li>
    <li>2025-09-02: Removed the <code class="language-plaintext highlighter-rouge">notify</code> condition after the ‘race condition’ was resolved via <a href="https://github.com/tphakala/birdnet-go/pull/1242">tphakala/birdnet-go#1242</a>.</li>
    <li>2025-10-16: Updated the <code class="language-plaintext highlighter-rouge">BirdNET Species Summary</code> command line sensor, <code class="language-plaintext highlighter-rouge">BirdNET Species Summary Persisted Data</code> template sensor, and <code class="language-plaintext highlighter-rouge">Notify rare bird detection</code> automation to work correctly. After dropping the attribute changes from history, the state detection changes were only being triggered when the species count increased. Instead, we now set the timestamp of the most recent change.</li>
  </ul>
</blockquote>

<h2 id="continuous-bird-detection">Continuous Bird Detection</h2>

<p>I thought it would be so cool if I could continuously record and detect all of the bird species around my house. This would provide additional information about which birds were in the area, and when I should look out for them.</p>

<p>My early research led me to a few projects that I could use.</p>

<p>One of the first products I found was <a href="https://haikubox.com/">Haikubox</a>. It’s a full hardware and software solution for detecting bird sounds around your house. It requires dedicated power and is a bit pricey. While their subscription cost for ongoing support and development is justified, I wasn’t quite ready to open up my wallet.</p>

<p>(The original) <a href="https://github.com/mcguirepr89/BirdNET-Pi">BirdNET-Pi</a> was another solution. When I first looked into this, BirdNET-Pi was a brand new project to run BirdNET on a Raspberry Pi. It would require my own waterproof hardware and microphone. If you’re not aware, I <em>strongly prefer</em> when my devices can operate without the internet as much as possible. This project instantly became a front-runner.</p>

<p>No matter the solution though, they all seemed to require dedicated power.</p>

<p>I didn’t have an accessible outdoor outlet, so getting power to any device was going to take additional effort. I ended up making a soft plan for all of the hardware, trench placement,  conduit, wiring, and permit research. But in the end, life became too busy and I never got around to it.</p>

<p>Until…</p>

<p>A few years later, while pushing my kids on the swing, I heard a bird sound I didn’t recognize. I quickly pulled out my phone and raced to open the Merlin app. But I was too slow and the bird flew away. I suddenly caught myself daydreaming of the continuous bird detections in BirdNET-Pi again. But that dream was immediately followed by the dread of figuring out when I could possibly complete an outdoor installation.</p>

<p><em>The next day</em>, I was reading through a thread on Reddit discussing lesser-known integrations with Home Assistant. I came across <a href="https://www.reddit.com/r/homeassistant/comments/1jiqumn/comment/mjh7y6i/">this golden reply</a> by <a href="https://www.reddit.com/user/bkw_17/">bkw_17</a>. They mentioned there was a newer BirdNET-based project that supported audio through an RTSP stream (a common way IP cameras stream video and audio). The project was called BirdNET-Go.</p>

<h2 id="the-perfect-solution-birdnet-go">The Perfect Solution: BirdNET-Go</h2>

<p><amp-img src="/assets/img/2025/05/birdnet-go_main_dashboard.png" alt="BirdNET-Go main dashboard" width="1154" height="903" layout="responsive"><noscript><img src="/assets/img/2025/05/birdnet-go_main_dashboard.png" alt="BirdNET-Go main dashboard" width="1154" height="903"></noscript></amp-img><em>My main dashboard on BirdNET-Go</em></p>

<p><a href="https://github.com/tphakala/birdnet-go/">BirdNET-Go</a> is a real-time BirdNET soundscape analyzer and classification tool for bird sounds. It is built on top of the work of the <a href="https://github.com/birdnet-team/BirdNET-Analyzer">BirdNET project</a>, and influenced by the original <a href="https://github.com/mcguirepr89/BirdNET-Pi">BirdNET-Pi project</a>.</p>

<p>BirdNET-Go includes a nice web interface for viewing detected birds, their frequencies, and playing back recordings. The project recently added an analytics dashboard in the nightly releases.</p>

<p><amp-img src="/assets/img/2025/05/birdnet-go_analytics_dashboard.png" alt="BirdNET-Go analytics dashboard" width="1426" height="1053" layout="responsive"><noscript><img src="/assets/img/2025/05/birdnet-go_analytics_dashboard.png" alt="BirdNET-Go analytics dashboard" width="1426" height="1053"></noscript></amp-img><em>My last 30 days of analytics in BirdNET-Go</em></p>

<p>But the killer feature is that <strong>BirdNET-Go can use the microphone audio from IP cameras</strong>! BirdNET-Go accepts the <a href="https://en.wikipedia.org/wiki/Real-Time_Streaming_Protocol">RTSP</a> stream from a network camera feed, splits out the audio, and uses that for detections. How had I never thought of this as a solution before?? I already have cameras outside, and they all have microphones. 🎤</p>

<p>Other than fidelity and detection accuracy, why would I need to use dedicated microphones in a new hardware box? It’s not like I was going to be using this for a professional recording studio. <strong>This is all a hobby</strong> and I bet this does the job just fine.</p>

<p>So everything was set into motion. If this worked, I no longer needed to run additional wiring or purchase new hardware. I could tap into the existing cameras I already had.</p>

<p><amp-img src="/assets/img/2025/05/birdnet-go_search_dashboard.png" alt="BirdNET-Go search dashboard" width="1278" height="854" layout="responsive"><noscript><img src="/assets/img/2025/05/birdnet-go_search_dashboard.png" alt="BirdNET-Go search dashboard" width="1278" height="854"></noscript></amp-img><em>The search dashboard on BirdNET-Go shows some of my favorite locked detections</em></p>

<h2 id="did-it-work">Did It Work?</h2>

<p>Yeah, it did! In a little over an hour, I was able to deploy a BirdNET-Go container on my server, connect the cameras as an audio source, and start detecting birds at my house.</p>

<p>My setup uses a variety of Amcrest cameras, so your mileage may vary when it comes to audio configuration and quality.</p>

<p>But I have some tips if you’re trying this at home on an existing camera.</p>

<h3 id="tweak-camera-audio-settings">Tweak Camera Audio Settings</h3>

<p>Almost immediately, I had issues with the camera audio sounding awful. I didn’t realize it, but the default camera audio settings had a “Noise Suppression” feature enabled. This ended up removing a lot of the bird sounds from my recordings. Once I turned that feature off, it began to record more ambient sounds.</p>

<p>Another tweak is that the default audio sampling frequency was far too low. It could barely provide usable bird audio. Increasing that from <code class="language-plaintext highlighter-rouge">8,000 Hz</code> to <code class="language-plaintext highlighter-rouge">48,000 Hz</code> did wonders for the audio quality.</p>

<p>I don’t know what the exact specifications are for the microphone in my cameras, but they sound good enough for me. In fact, the specifications document for the camera lists the microphone information as “supported”. 😆</p>

<p>I’ve included a few of my favorite recordings <a href="#favorite-bird-recordings">toward the bottom of this post</a>.</p>

<h3 id="wind-noise">Wind Noise</h3>

<p>Outdoor cameras positioned high up are prone to wind noise. I had a lot of wind noise in my early detection recordings, and the muffles made it painful to play back the clips.</p>

<p>What’s the easiest way to fix this? I had known about action cameras and drones using windscreens over the microphones to help reduce wind noise. I figured that should easily apply to a stationary security camera microphone too.</p>

<p>I ended up going with the <a href="https://www.amazon.com/dp/B0CYGGTJHY">Insta360 X4 Mic Wind Muff</a> because it was coming from a name-brand company, its adhesive velcro pad was much larger than its competitors, and the velcro pad cutout looked large enough to fit around my camera’s microphone hole. It was only $9 for 6 of them. I had so little to lose and so much to gain.</p>

<p><amp-img src="/assets/img/2025/05/camera_windscreen.jpg" alt="An Amcrest security camera with a black action-camera windscreen installed." width="800" height="603" layout="responsive"><noscript><img src="/assets/img/2025/05/camera_windscreen.jpg" alt="An Amcrest security camera with a black action-camera windscreen installed." width="800" height="603"></noscript></amp-img><em>Outdoor Amcrest security camera with an “Insta360 X4 Mic Wind Muff” installed over the mic to reduce wind noise (above a 😮 face)</em></p>

<p>Luckily, all of my cameras were out of direct rain and snow. This meant that I didn’t have to worry about the foam getting wet and staying saturated.</p>

<p>After I installed it, I didn’t know if it was working until I noticed some pretty faint wind chimes alongside a recording of an American Robin. But they weren’t my wind chimes. Instead, they were from my neighbor’s porch. 🤣</p>

<p>I went into this only expecting a 50% reduction in wind noise. But this removed almost all but the <em>highest winds</em>, and even those were <em>significantly</em> quieter. So yeah, this seems to work perfectly for any normal amount of wind.</p>

<p>I’ve only had them installed for 2 months, so I’m not sure how well the adhesive will hold up over time. But so far, they’re working significantly better than I anticipated.</p>

<h2 id="birdnet-go-usage">BirdNET-Go Usage</h2>

<p>I’ve now been using BirdNET-Go for 2 months. My usage can be broken down into 2 primary categories:</p>

<h3 id="educational">Educational</h3>

<p>I have an activity with my 2-year-old where we scroll through yesterday’s dashboard and try to name each bird (by its picture) and listen to their calls. This kid is like a sponge and he is getting shockingly good at recognizing birds by their appearance or calls. 🧽</p>

<p>Then as we go on our walks, we try to match what we’ve learned with what we see and hear. It’s a fun way to spend time together and learn about the world around us.</p>

<h3 id="tracking">Tracking</h3>

<p>I use BirdNET-Go to track birds and to get a general idea about what’s around my house. It has allowed me to be more aware of the birds that stick around and which ones are migrating through the area.</p>

<p>To support my tracking, I combine BirdNET-Go with a few automations set up in Home Assistant that notify me of certain conditions–like when specific species are detected. This encourages me to step outside, locate them, and cross them off of my “Species observed” list.</p>

<p><em>Huge</em> shout out to <a href="https://github.com/tphakala">Tomi P. Hakala</a> who built the BirdNET-Go software layer on top of the BirdNET project and <a href="https://github.com/mcguirepr89">mcguirepr89</a> for his original BirdNET-Pi project. Without the work from either of those two developers (and countless others!), there is no chance I would have been able to get this project off the ground.</p>

<blockquote>
  <p>Shameless plug; I’ve made a few <a href="https://github.com/tphakala/birdnet-go/pulls?q=is%3Apr+is%3Amerged+author%3Aaav7fl">very minor contributions</a> to the BirdNET-Go project because I think it’s so awesome, and I think you should too.</p>
</blockquote>

<p>Let’s dig into how I consume the data from BirdNET-Go, the cards I created in Home Assistant, and the automations to make it all work.</p>

<h2 id="home-assistant-sensors">Home Assistant Sensors</h2>

<p><amp-img src="/assets/img/2025/05/amerob.jpg" alt="An American Robin fledgling on the railing of a deck." width="800" height="602" layout="responsive"><noscript><img src="/assets/img/2025/05/amerob.jpg" alt="An American Robin fledgling on the railing of a deck." width="800" height="602"></noscript></amp-img><em>An American Robin fledgling on our back deck railing.</em></p>

<blockquote>
  <p>A lot of these sensors are dependent on using any release on or after <a href="https://github.com/tphakala/birdnet-go/releases/tag/nightly-20250427">Nightly Build 20250427</a> which adds the analytics dashboard and my change to the BirdNET-Go API to return the species code in the daily summary API endpoint (used for the eBird links).</p>
</blockquote>

<p>If it wasn’t already clear, we’re going to be using <a href="https://www.home-assistant.io/">Home Assistant</a> to consume the data from BirdNET-Go and to send notifications to the user. Home Assistant is a great home automation platform that can be used to integrate with a variety of devices and services.</p>

<p>Here are two <code class="language-plaintext highlighter-rouge">command_line</code> sensors I created to pull data from the BirdNET-Go API and include the data in Home Assistant.</p>

<p>Each of the <code class="language-plaintext highlighter-rouge">command_line</code> sensors has a <em>matching</em> <code class="language-plaintext highlighter-rouge">template</code> sensor. It is used to persist data even when the BirdNET-Go API isn’t available (like when the machine first boots up). <strong>This is important!</strong></p>

<p>If the BirdNET-Go API is down, the <code class="language-plaintext highlighter-rouge">command_line</code> sensors will fail and the sensor will resolve to <code class="language-plaintext highlighter-rouge">unknown</code>.</p>

<p>Normally this would not be a problem. But my notification automations work by comparing the previous and current state of each sensor. When the API comes back up, if the previous <code class="language-plaintext highlighter-rouge">command_line</code> sensor state was <code class="language-plaintext highlighter-rouge">unknown</code>, we will not be able to accurately compare the changes to <em>now</em>. This is most likely to occur when Home Assistant and BirdNET-Go are restarted on the host machine.</p>

<p>We can work around these edge cases by persisting the data we last <em>knew</em> about. I chose to do this by creating an additional <code class="language-plaintext highlighter-rouge">template</code> sensor for each <code class="language-plaintext highlighter-rouge">command_line</code> sensor and ignoring any <code class="language-plaintext highlighter-rouge">unknown</code> and <code class="language-plaintext highlighter-rouge">unavailable</code> states. The result is a <code class="language-plaintext highlighter-rouge">template</code> sensor that will always have the last <em>known</em> state of the <code class="language-plaintext highlighter-rouge">command_line</code> sensor.</p>

<p>Below, I chose to only use the persisted_data <code class="language-plaintext highlighter-rouge">template</code> sensors in the <em>automations</em>, while continuing to use the non-persisted <code class="language-plaintext highlighter-rouge">command_line</code> sensors for the <em>dashboard cards</em>. I prefer that the dashboard cards always represent the current <em>live</em> state from BirdNET-Go (even if it’s not working). While on the other hand, the automations are all about comparing the current state with the last state <em>we knew about</em>.</p>

<p><strong>⚠️ NOTE:</strong> Since the <code class="language-plaintext highlighter-rouge">template</code> sensor ignores <code class="language-plaintext highlighter-rouge">unknown</code> and <code class="language-plaintext highlighter-rouge">unavailable</code> states (which is what happens when Home Assistant starts), you’ll likely need to wait for the first successful <em>change</em> of the non-persisted <code class="language-plaintext highlighter-rouge">command_line</code> sensor <strong>state</strong> before the persisted_data <code class="language-plaintext highlighter-rouge">template</code> sensor will update and work correctly. If you’re impatient, you can always force the <code class="language-plaintext highlighter-rouge">command_line</code> sensor <code class="language-plaintext highlighter-rouge">state</code> to change to <em>any other value</em> in Home Assistant by using the <a href="https://www.home-assistant.io/docs/tools/dev-tools/#states-tab">states tab</a> under the dev tools. Don’t worry, it will always revert to the correct value when the <code class="language-plaintext highlighter-rouge">command_line</code> sensor updates again.</p>

<h3 id="sensor-for-daily-species-summary">Sensor for Daily Species Summary</h3>

<p>This command line sensor fetches the <em>daily summary</em> of bird species detected by BirdNET-Go using the <code class="language-plaintext highlighter-rouge">/api/v2/analytics/species/daily</code> endpoint. It uses <code class="language-plaintext highlighter-rouge">jq</code> to extract the <code class="language-plaintext highlighter-rouge">species_list</code>. The sensor’s state is the count of unique species detected, and it stores the full list of species as an attribute.</p>

<details>

  <summary>[Yaml] Home Assistant Sensor - Daily Summary</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># configuration.yaml</span>
<span class="na">command_line</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">command_line.yaml</span>
<span class="na">template</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">template.yaml</span>
</code></pre></div>  </div>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># command_line.yaml</span>
<span class="c1"># version 1.1</span>
<span class="pi">-</span> <span class="na">sensor</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">BirdNET</span><span class="nv"> </span><span class="s">Daily</span><span class="nv"> </span><span class="s">Summary"</span>
    <span class="na">unique_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">birdnet_daily_summary"</span>
    <span class="c1"># Updated command uses jq to check input type and provide a default empty list</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">curl --connect-timeout 5 --max-time 10 --retry 3 --retry-delay 0 --retry-max-time 30 -s 'http://YOUR_BIRDNET_ENDPOINT:YOUR_BIRDNET_PORT/api/v2/analytics/species/daily' |</span>
      <span class="s">jq 'if type == "array" then {species_list: .} end'</span>
    <span class="na">value_template</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">{% if value_json is defined and value_json.species_list is iterable and value_json.species_list is not string %}</span>
        <span class="s">{{ value_json.species_list | length }}</span>
      <span class="s">{% endif %}</span>
    <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">species"</span>
    <span class="na">json_attributes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">species_list</span>
    <span class="na">scan_interval</span><span class="pi">:</span> <span class="m">60</span> <span class="c1"># Or adjust as needed</span>
    <span class="na">command_timeout</span><span class="pi">:</span> <span class="m">35</span>
</code></pre></div>  </div>

  <blockquote>
    <p>The specific <code class="language-plaintext highlighter-rouge">template</code> sensor below is <strong>optional</strong> as it’s not used in any of my automations. However, I’ve included it as you may find it useful for writing your own automations that use the daily counts and frequencies.</p>
  </blockquote>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># template.yaml</span>
<span class="c1"># version 1.0</span>
<span class="c1"># The data in this sensor won't be populated for the first time until the command_line sensor _changes_ to a _different_ state. This can be forced manually in the dev tools states tab.</span>
<span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">state</span>
     <span class="na">entity_id</span><span class="pi">:</span> <span class="s">sensor.birdnet_daily_summary</span>
     <span class="na">not_to</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">unknown</span>
       <span class="pi">-</span> <span class="s">unavailable</span>
  <span class="na">sensor</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">BirdNET Daily Summary Persisted Data</span>
     <span class="na">unique_id</span><span class="pi">:</span> <span class="s">birdnet_daily_summary_persisted_data</span>
     <span class="na">state</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{{</span><span class="nv"> </span><span class="s">trigger.to_state.state</span><span class="nv"> </span><span class="s">}}'</span>
     <span class="na">attributes</span><span class="pi">:</span>
       <span class="na">species_list</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{{</span><span class="nv"> </span><span class="s">trigger.to_state.attributes.species_list</span><span class="nv"> </span><span class="s">}}'</span>
     <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">species"</span>
</code></pre></div>  </div>

</details>

<h3 id="sensor-for-overall-species-summary">Sensor for Overall Species Summary</h3>

<p>This command line sensor fetches the <em>overall species summary</em> from BirdNET-Go using the <code class="language-plaintext highlighter-rouge">/api/v2/analytics/species/summary</code> endpoint. This means it gets the species summary for not only today but also when data was first recorded by BirdNET-Go.</p>

<p>Just like the previous sensor, it uses <code class="language-plaintext highlighter-rouge">jq</code> to extract the <code class="language-plaintext highlighter-rouge">species_list</code>. The sensor’s state is the count of unique species detected, and it stores the full list of species as an attribute.</p>

<details>

  <summary>[Yaml] Home Assistant Sensor - Species Summary</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># configuration.yaml</span>
<span class="na">command_line</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">command_line.yaml</span>
<span class="na">template</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">template.yaml</span>
</code></pre></div>  </div>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># command_line.yaml</span>
<span class="c1"># version 1.2</span>
<span class="pi">-</span> <span class="na">sensor</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">BirdNET</span><span class="nv"> </span><span class="s">Species</span><span class="nv"> </span><span class="s">Summary"</span>
    <span class="na">unique_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">birdnet_species_summary"</span>
    <span class="c1"># Uses jq to check input type and provide a default empty list</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">curl --connect-timeout 5 --max-time 10 --retry 3 --retry-delay 0 --retry-max-time 30 -s 'http://YOUR_BIRDNET_ENDPOINT:YOUR_BIRDNET_PORT/api/v2/analytics/species/summary' |</span>
      <span class="s">jq 'if type == "array" then {species_list: .} end'</span>
    <span class="c1"># Value_template calculates the number of species in the list</span>
    <span class="na">value_template</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">{% if value_json is defined and value_json.species_list is iterable and (value_json.species_list | length) &gt; 0 %}</span>
        <span class="s">{{ (value_json.species_list | map(attribute='last_heard') | max | as_datetime | as_local) }}</span>
      <span class="s">{% endif %}</span>
    <span class="na">device_class</span><span class="pi">:</span> <span class="s">timestamp</span>
    <span class="na">json_attributes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">species_list</span>
    <span class="na">scan_interval</span><span class="pi">:</span> <span class="m">60</span> <span class="c1"># Or adjust as needed</span>
    <span class="na">command_timeout</span><span class="pi">:</span> <span class="m">25</span>
</code></pre></div>  </div>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># template.yaml</span>
<span class="c1"># version 1.1</span>
<span class="c1"># The data in this sensor won't be populated for the first time until the command_line sensor _changes_ to a _different_ state. This can be forced manually in the dev tools states tab.</span>
<span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">state</span>
     <span class="na">entity_id</span><span class="pi">:</span> <span class="s">sensor.birdnet_species_summary</span>
     <span class="na">not_to</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">unknown</span>
       <span class="pi">-</span> <span class="s">unavailable</span>
  <span class="na">sensor</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">BirdNET Species Summary Persisted Data</span>
     <span class="na">unique_id</span><span class="pi">:</span> <span class="s">birdnet_species_summary_persisted_data</span>
     <span class="na">state</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{{</span><span class="nv"> </span><span class="s">trigger.to_state.state</span><span class="nv"> </span><span class="s">}}'</span>
     <span class="na">attributes</span><span class="pi">:</span>
       <span class="na">species_list</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{{</span><span class="nv"> </span><span class="s">trigger.to_state.attributes.species_list</span><span class="nv"> </span><span class="s">}}'</span>
     <span class="na">device_class</span><span class="pi">:</span> <span class="s">timestamp</span>
</code></pre></div>  </div>

</details>

<h3 id="notes">Notes</h3>

<p>Here are some additional notes and tips regarding the sensors and their configuration.</p>

<h4 id="recorder">Recorder</h4>

<p>If you have a large number of birds detected, you may run into issues where the attributes are too large to be reasonably recorded in the Home Assistant history database. You might get a log message like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>State attributes for sensor.birdnet_* exceed maximum size of * bytes. 
This can cause database performance issues; Attributes will not be stored
</code></pre></div></div>

<p>The easiest solution is to exclude the sensors from being recorded in the database. In my testing, this still allowed the latest value to persist through a reboot while preventing history from being recorded. You can do this by adding the following to your <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># configuration.yaml</span>
<span class="c1"># version 1.0</span>
<span class="na">recorder</span><span class="pi">:</span>
  <span class="na">exclude</span><span class="pi">:</span>
    <span class="na">entities</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet_daily_summary</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet_daily_summary_persisted_data</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet_species_summary</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet_species_summary_persisted_data</span>
</code></pre></div></div>

<h4 id="faster-responsiveness">Faster Responsiveness</h4>

<p>In addition to the polling from the <code class="language-plaintext highlighter-rouge">command_line</code> sensors, you can also set up a simple automation that forces a new fetch from each of the endpoints by using the MQTT topic <code class="language-plaintext highlighter-rouge">birdnet</code> as a trigger.</p>

<p>The only requirement is that you set up the MQTT integration in BirdNET-Go and have it publish to the same MQTT broker that Home Assistant is listening to.</p>

<p>We treat the incoming MQTT update like a push trigger to fetch updates for the <code class="language-plaintext highlighter-rouge">command_line</code> sensors before their next <code class="language-plaintext highlighter-rouge">scan_interval</code> starts. This cuts down on the time it takes to get updates for the sensors, and makes our notifications react as quickly as possible.</p>

<p>We don’t care about the MQTT payload, instead, we only care if <em>something</em> changes in BirdNET-Go.</p>

<p>Below is a template sensor that listens to the BirdNET-Go MQTT topic.</p>

<details>

  <summary>[Yaml] Home Assistant Sensor - BirdNET-Go MQTT</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># configuration.yaml</span>
<span class="na">template</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">template.yaml</span>
</code></pre></div>  </div>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># template.yaml</span>
<span class="c1"># version 1.0</span>
<span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">mqtt</span>
      <span class="na">topic</span><span class="pi">:</span> <span class="s">birdnet</span>
    <span class="c1"># Reset at midnight to align with "a new daily summary"</span>
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">time_pattern</span>
      <span class="na">hours</span><span class="pi">:</span> <span class="m">0</span>
      <span class="na">minutes</span><span class="pi">:</span> <span class="m">0</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">reset</span>
  <span class="na">sensor</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">BirdNET</span>
      <span class="na">unique_id</span><span class="pi">:</span> <span class="s">birdnet</span>
      <span class="na">state</span><span class="pi">:</span> <span class="pi">&gt;-</span>
        <span class="s">{% if trigger.id == 'reset' %}</span>
          <span class="s">unavailable</span>
        <span class="s">{% elif trigger.payload_json is defined %}</span>
          <span class="s">{{ today_at(trigger.payload_json.Time) }}</span>
        <span class="s">{% else %}</span>
          <span class="s">unknown</span>
        <span class="s">{% endif %}</span>
      <span class="na">icon</span><span class="pi">:</span> <span class="s">mdi:bird</span>
</code></pre></div>  </div>

</details>

<p>Below is the automation portion which forces the <code class="language-plaintext highlighter-rouge">command_line</code> sensors to update each time the BirdNET-Go MQTT sensor changes.</p>

<details>

  <summary>[Yaml] Home Assistant Automation - Command Line Sensor Manual Updates</summary>

  <p><a href="https://my.home-assistant.io/redirect/automations/" target="_blank" rel="noreferrer noopener"><amp-img src="https://my.home-assistant.io/badges/automations.svg" alt="Open your Home Assistant instance and show your automations." style="margin-left: unset" width="217.08333333333331" height="40" layout="responsive"><noscript><img src="https://my.home-assistant.io/badges/automations.svg" alt="Open your Home Assistant instance and show your automations." style="margin-left: unset" width="217.08333333333331" height="40"></noscript></amp-img></a> <!-- https://my.home-assistant.io/create-link/ --></p>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># Automation</span>
<span class="c1"># version 1.0</span>
<span class="na">alias</span><span class="pi">:</span> <span class="s">Trigger BirdNET-Go API fetch</span>
<span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="na">triggers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span> <span class="s">state</span>
    <span class="na">entity_id</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet</span>
<span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">parallel</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">homeassistant.update_entity</span>
        <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
        <span class="na">data</span><span class="pi">:</span>
          <span class="na">entity_id</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">sensor.birdnet_daily_summary</span>
      <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">homeassistant.update_entity</span>
        <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
        <span class="na">data</span><span class="pi">:</span>
          <span class="na">entity_id</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">sensor.birdnet_species_summary</span>  
<span class="na">mode</span><span class="pi">:</span> <span class="s">queued</span>
<span class="na">max</span><span class="pi">:</span> <span class="m">5</span>
</code></pre></div>  </div>

</details>

<h2 id="home-assistant-cards">Home Assistant Cards</h2>

<p><amp-img src="/assets/img/2025/05/rthhum.jpg" alt="A Ruby-throated Hummingbird eating from a hanging fuchsia basket" width="800" height="600" layout="responsive"><noscript><img src="/assets/img/2025/05/rthhum.jpg" alt="A Ruby-throated Hummingbird eating from a hanging fuchsia basket" width="800" height="600"></noscript></amp-img><em>A Ruby-throated Hummingbird visiting our fuchsia basket.</em></p>

<p>Below I’ve created a few <code class="language-plaintext highlighter-rouge">markdown</code> cards in Home Assistant to display the data from the BirdNET-Go sensors. I liked having all the information in one place and using markdown tables was the quickest way to get something out there.</p>

<p>Could there be improvements or optimizations to these Home Assistant dashboard cards below? Absolutely. But unless you’re running on a <a href="https://en.wikipedia.org/wiki/TI-84_Plus_series">Zilog Z80</a>, I don’t think you’re going to notice a faster loop speed in a home setting. I won’t let perfection be the enemy of good enough.</p>

<h3 id="card-daily-species-summary-with-sparklines">Card: Daily Species Summary With Sparklines</h3>

<p><amp-img src="/assets/img/2025/05/home_assistant_birdnet_sparkline_card.png" alt="Home Assistant dashboard showing today's BirdNET detections frequencies being represented by a sparkline chart" width="500" height="989" layout="responsive"><noscript><img src="/assets/img/2025/05/home_assistant_birdnet_sparkline_card.png" alt="Home Assistant dashboard showing today's BirdNET detections frequencies being represented by a sparkline chart" width="500" height="989"></noscript></amp-img><em>Today’s BirdNET detections and frequencies are represented by a sparkline chart</em></p>

<blockquote>
  <p>Requires: <a href="#sensor-for-daily-species-summary">Sensor for Daily Species Summary</a></p>
</blockquote>

<p>This is my favorite card and the one I find myself looking at the most. This card closely matches what one would find on their BirdNET-Go dashboard. It shows today’s detected species, their overall count, and a fun sparkline chart that represents the frequency of detections throughout the day.</p>

<p>I first got the idea for the sparklines from this <a href="https://github.com/tphakala/birdnet-go/issues/587">GitHub issue</a> where someone wanted to add them to the daily summary dashboard in <em>BirdNET-Go</em>. Thanks!</p>

<p>Since there isn’t an easy way to fit a full sparkline chart on mobile in the markdown card, I decided to “combine” all the counts from the quietest hours into a single bar.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Bar 1</code> = Combined counts from 12:00 AM - 06:00 AM</li>
  <li>
<code class="language-plaintext highlighter-rouge">Bar 2..13</code> = Hourly counts from 06:00 AM - 06:00 PM</li>
  <li>
<code class="language-plaintext highlighter-rouge">Bar 14</code> = Combined counts from 06:00 PM - 12:00 AM</li>
</ul>

<p>An alternative idea would be to combine every 2 hours into a bar, giving an even distribution of data. However as most of my data was during the daytime, I decided to keep the precision from 06:00 AM - 06:00 PM.</p>

<p>I also included another idea from <a href="https://community.home-assistant.io/t/displaying-birdnet-go-detections/713611/24">Alexandre</a> who suggested using the species code from BirdNET-Go and linking to the eBird website with it. 👏 This way you can quickly look up the species and see more information about them from your dashboard card.</p>

<details>

  <summary>[Yaml] Home Assistant Card - Daily Summary with Sparklines</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.0</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">markdown</span>
<span class="na">content</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">{% if has_value('sensor.birdnet_daily_summary') %}  </span>

  <span class="s">{% set species_data = state_attr('sensor.birdnet_daily_summary',</span>
  <span class="s">'species_list') %}</span>

  <span class="s">{% if species_data and species_data | count &gt; 0 %}</span>

  <span class="s">Last Heard | Species | Count | Sparkline (6AM-6PM)</span>

  <span class="s">:-- | :-- | :-- | --</span>

  <span class="s">{% for bird in species_data | sort(attribute='latest_heard', reverse=true) |</span>
  <span class="s">sort(attribute='count', reverse=true) %}</span>

  <span class="s">{#- Basic Info -#}</span>

  <span class="s">{%- set time = bird.latest_heard -%}</span>

  <span class="s">{%- set name = bird.common_name -%}</span>

  <span class="s">{%- set count = bird.count -%}</span>

  <span class="s">{%- set species_code = bird.species_code %}</span>

  <span class="s">{%- set ebird_url = "https://ebird.org/species/" ~ species_code %}</span>

  <span class="s">{#--- Sparkline Calculation (Full Day Aggregated - 14 slots) ---#}</span>

  <span class="s">{%- set hourly = bird.hourly_counts -%}</span>

  <span class="s">{%- set sparkline_str = "N/A" -%} {#- Default value -#}</span>

  <span class="s">{%- if hourly is defined and hourly is iterable and hourly | count == 24 -%}</span>
    <span class="s">{#- Aggregate counts: [0-6], 6..18, [18-24] (14 slots total, safe concatenation) -#}</span>
    <span class="s">{%- set early_sum = hourly[0:6] | sum -%}</span>
    <span class="s">{%- set middle_part = hourly[6:18] -%}</span>
    <span class="s">{%- set late_sum = hourly[18:24] | sum -%}</span>
    <span class="s">{%- set aggregated_counts = [early_sum] + middle_part + [late_sum] -%}</span>

    <span class="s">{# Check if list has expected count before finding max #}</span>
    <span class="s">{%- if aggregated_counts | count == 14 -%}</span>
      <span class="s">{#- Find Max for Scaling -#}</span>
      <span class="s">{%- set max_val = aggregated_counts | max -%}</span>

      <span class="s">{#- Define Sparkline Characters (7 levels, U+2581 to U+2587) -#}</span>
      <span class="s">{%- set spark_chars = ['▁', '▂', '▃', '▄', '▅', '▆', '▇'] -%}</span>
      <span class="s">{%- set sparkline = namespace(text="") -%}</span>

      <span class="s">{%- for v in aggregated_counts -%}</span>
        <span class="s">{#- Map value to character index (0-6), scale factor 7, max index 6 -#}</span>
        <span class="s">{%- set char_index = ([0, (v * 7 / max_val)|int , 6] | sort)[1] if max_val &gt; 0 else 0 -%} {#&lt;-- 2. Use 7 levels for scaling/clamping #}</span>
        <span class="s">{#- Append character -#}</span>
        <span class="s">{%- set sparkline.text = sparkline.text ~ spark_chars[char_index] -%}</span>
      <span class="s">{%- endfor -%}</span>
      <span class="s">{%- set sparkline_str = sparkline.text -%}</span>
    <span class="s">{%- else -%}</span>
       <span class="s">{% set sparkline_str = "?" * 12 %}</span>
    <span class="s">{%- endif -%}</span>
  <span class="s">{%- endif -%}</span>

  <span class="s">{#--- End Sparkline Calculation ---#}</span>


  <span class="s">{#- Output Row -#}</span>

  <span class="s">{{ today_at(time) | as_timestamp  | timestamp_custom('%H:%M', true)}} | [{{</span>
  <span class="s">name }}]({{ ebird_url }}) | {{ count }} | {{ sparkline_str }}</span>

  <span class="s">{% endfor %}</span>


  <span class="s">---</span>

  <span class="s">{{ species_data | sum(attribute='count') | int }} Detections</span>

  <span class="s">{{ species_data | count }} Species</span>

  <span class="s">{% else %}</span>

  <span class="s">No bird species data available or list is empty.</span>

  <span class="s">{% endif %}</span>

  <span class="s">{% else %}</span>

  <span class="s">BirdNET-Go API is not available.</span>

  <span class="s">{% endif %}</span>
</code></pre></div>  </div>

</details>

<h3 id="card-latest-species-detections">Card: Latest Species Detections</h3>

<p><amp-img src="/assets/img/2025/05/home_assistant_birdnet_latest_detections.png" alt="Home Assistant dashboard showing BirdNET's the most recent species detected" width="1026" height="788" layout="responsive"><noscript><img src="/assets/img/2025/05/home_assistant_birdnet_latest_detections.png" alt="Home Assistant dashboard showing BirdNET's the most recent species detected" width="1026" height="788"></noscript></amp-img><em>BirdNET’s latest species detections sorted by most recent</em></p>

<blockquote>
  <p>Requires: <a href="#sensor-for-overall-species-summary">Sensor for Overall Species Summary</a></p>
</blockquote>

<p>It’s a fun problem to have, but sometimes it’s challenging to scan through the daily detection summary to see what the most recent detections are. This card solves that problem by showing the most recent detections in a simple markdown table sorted by the last heard time in a human-readable format.</p>

<p>Unlike the daily summary card, this card does not reset after midnight. It’s helpful for scanning for detected birds from the prior night.</p>

<details>

  <summary>[Yaml] Home Assistant Card - Latest Detections</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.0</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">markdown</span>
<span class="na">content</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">{% if has_value('sensor.birdnet_species_summary') %}  </span>
  <span class="s">{% set species_data = state_attr('sensor.birdnet_species_summary', 'species_list') %} </span>
  <span class="s">{% if species_data and species_data | count &gt; 0 %}</span>
    <span class="s">Latest Detections | &amp;nbsp;&amp;nbsp;&amp;nbsp;Last Heard </span>
    <span class="s">:-- | :-- </span>
    <span class="s">{% for bird in (species_data | sort(attribute='last_heard', reverse=true))[0:11] %}</span>
      <span class="s">{%- set time = bird.last_heard -%}</span>
      <span class="s">{%- set name = bird.common_name -%}</span>
      <span class="s">{%- set species_code = bird.species_code %}</span>
      <span class="s">{%- set ebird_url = "https://ebird.org/species/" ~ species_code %}</span>
    <span class="s">  {%- set last_heard_datetime = strptime(time, '%Y-%m-%d %H:%M:%S') %}[{{ name }}]({{ ebird_url }}) | &amp;nbsp;&amp;nbsp;&amp;nbsp;{{ relative_time(last_heard_datetime) }} ago </span>
    <span class="s">{% endfor %}</span>
  <span class="s">{% else %} </span>
    <span class="s">No recent bird data available. </span>
  <span class="s">{% endif %}</span>
  <span class="s">{% else %}</span>
    <span class="s">BirdNET-Go API is not available.</span>
  <span class="s">{% endif %}</span>
</code></pre></div>  </div>

</details>

<h3 id="card-birds-of-interest">Card: Birds of Interest</h3>

<p><amp-img src="/assets/img/2025/05/home_assistant_birdnet_birds_of_interest.png" alt="Home Assistant dashboard showing a filtered list of birds I'm interested in tracking" width="1031" height="619" layout="responsive"><noscript><img src="/assets/img/2025/05/home_assistant_birdnet_birds_of_interest.png" alt="Home Assistant dashboard showing a filtered list of birds I'm interested in tracking" width="1031" height="619"></noscript></amp-img><em>A filtered list of birds I’m interested in tracking</em></p>

<blockquote>
  <p>Requires: <a href="#sensor-for-overall-species-summary">Sensor for Overall Species Summary</a></p>
</blockquote>

<p>While the two summary cards have been great, I also found myself searching the card for birds I was interested in keeping an eye out for. To solve this problem, I created <em>another</em> card that takes in a case-<em>insensitive</em> list of birds and matches their common name with the list in the species summary sensor.</p>

<p>This is helpful for birds I might not see every day, but I want to know when they’re back in the area without opening up the BirdNET-Go dashboard and flipping through the last few days.</p>

<p>It’s a pretty manual process to add the birds to the list, but I change this so infrequently that it wasn’t worth the effort to engineer any further.</p>

<details>

  <summary>[Yaml] Home Assistant Card - Birds of Interest</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.0</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">markdown</span>
<span class="na">content</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">{% if has_value('sensor.birdnet_species_summary') %}  </span>
  <span class="s">{% set birds_of_interest = [</span>
    <span class="s">'white-crowned sparrow',</span>
    <span class="s">'baltimore oriole',</span>
    <span class="s">'black-capped chickadee',</span>
    <span class="s">'tufted titmouse',</span>
    <span class="s">'osprey',</span>
    <span class="s">'yellow-rumped warbler',</span>
    <span class="s">'nashville warbler',</span>
    <span class="s">'',</span>
    <span class="s">'',</span>
    <span class="s">'',</span>
    <span class="s">''] %} </span>
  <span class="s">{% set birds_pattern = '(?i)^(' ~ birds_of_interest | join('|') ~ ')$' %}</span>
  <span class="s">{% set species_data_all = state_attr('sensor.birdnet_species_summary', 'species_list') %}</span>
  <span class="s">{% set species_data_filtered = [] %} </span>
  <span class="s">{% if species_data_all %}</span>
    <span class="s">{% set species_data_filtered = species_data_all | selectattr('common_name', 'match', birds_pattern) | list %} </span>
  <span class="s">{% endif %} </span>
  <span class="s">{% if species_data_filtered and species_data_filtered | count &gt; 0 %}</span>
    <span class="s">Latest Detections | &amp;nbsp;&amp;nbsp;&amp;nbsp;Last Heard</span>
    <span class="s">:-- | :-- </span>
    <span class="s">{% for bird in (species_data_filtered | sort(attribute='last_heard', reverse=true)) %}</span>
  <span class="s">    {%- set time = bird.last_heard -%}   </span>
      <span class="s">{%- set name = bird.common_name -%}   </span>
      <span class="s">{%- set species_code = bird.species_code %}   </span>
      <span class="s">{%- set ebird_url = "https://ebird.org/species/" ~ species_code %}   </span>
      <span class="s">{%- set last_heard_datetime = strptime(time, '%Y-%m-%d %H:%M:%S') %}[{{ name }}]({{ ebird_url }}) | &amp;nbsp;&amp;nbsp;&amp;nbsp;{{ relative_time(last_heard_datetime) }} ago </span>
    <span class="s">{% endfor %}</span>
  <span class="s">{% else %} </span>
    <span class="s">No recent detections of specified birds. </span>
  <span class="s">{% endif %}</span>
  <span class="s">{% else %}</span>
    <span class="s">BirdNET-Go API is not available.</span>
  <span class="s">{% endif %}</span>
</code></pre></div>  </div>

</details>

<h3 id="card-brand-new-detections">Card: Brand New Detections</h3>

<p><amp-img src="/assets/img/2025/05/home_assistant_birdnet_newest_birds.png" alt="Home Assistant dashboard showing BirdNET's birds that have been detected for the first time" width="1009" height="781" layout="responsive"><noscript><img src="/assets/img/2025/05/home_assistant_birdnet_newest_birds.png" alt="Home Assistant dashboard showing BirdNET's birds that have been detected for the first time" width="1009" height="781"></noscript></amp-img><em>A list of birds that have been detected for the very first time</em></p>

<blockquote>
  <p>Requires: <a href="#sensor-for-overall-species-summary">Sensor for Overall Species Summary</a></p>
</blockquote>

<p>Last, this fun card shows the birds that have been detected for the very first time. This is a great way to see what <em>new</em> birds are in the area and if I should be on the lookout for them.</p>

<p><em>However</em>, once a bird makes this list and rolls off, it will never be on this list again. So it is a bit of a one-time use card, but still fun to track as I’m new to birding this year.</p>

<details>

  <summary>[Yaml] Home Assistant Card - Brand New Detections</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.0</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">markdown</span>
<span class="na">content</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">{% if has_value('sensor.birdnet_species_summary') %}  </span>
  <span class="s">{% set species_data = state_attr('sensor.birdnet_species_summary', 'species_list') %} </span>
  <span class="s">{% if species_data and species_data | count &gt; 0 %}</span>
    <span class="s">Latest Detections | &amp;nbsp;&amp;nbsp;&amp;nbsp;Count | &amp;nbsp;&amp;nbsp;&amp;nbsp;First Heard </span>
    <span class="s">:-- | :-- | :--</span>
    <span class="s">{% for bird in (species_data | sort(attribute='first_heard', reverse=true))[0:11] %}</span>
      <span class="s">{%- set time = bird.first_heard -%}</span>
      <span class="s">{%- set name = bird.common_name -%}</span>
      <span class="s">{%- set count = bird.count -%}</span>
      <span class="s">{%- set species_code = bird.species_code %}</span>
      <span class="s">{%- set ebird_url = "https://ebird.org/species/" ~ species_code %}</span>
      <span class="s">{%- set first_heard_datetime = strptime(time, '%Y-%m-%d %H:%M:%S') %}[{{ name }}]({{ ebird_url }}) | &amp;nbsp;&amp;nbsp;&amp;nbsp;{{ count }} | &amp;nbsp;&amp;nbsp;&amp;nbsp;{{ relative_time(first_heard_datetime) }} ago </span>
    <span class="s">{% endfor %}</span>
  <span class="s">{% else %} </span>
    <span class="s">No recent bird data available. </span>
  <span class="s">{% endif %}</span>
  <span class="s">{% else %}</span>
    <span class="s">BirdNET-Go API is not available.</span>
  <span class="s">{% endif %}</span>
</code></pre></div>  </div>

</details>

<h2 id="notifications">Notifications</h2>

<p><amp-img src="/assets/img/2025/05/pilwoo.jpg" alt="A Pileated Woodpecker searching for food in a dead tree." width="400" height="531" layout="responsive"><noscript><img src="/assets/img/2025/05/pilwoo.jpg" alt="A Pileated Woodpecker searching for food in a dead tree." width="400" height="531"></noscript></amp-img><em>A Pileated Woodpecker pecking away at a dead tree in my backyard.</em></p>

<p>Here is where the fun begins. Below are my collections of notifications that I’ve set up in Home Assistant based on the created sensors above.</p>

<p>I’ve simplified some of the notifications from my personal setup. But here are some ideas that you could implement on your own:</p>

<ul>
  <li>Only send notifications when you’re home</li>
  <li>Only send notifications when you’re not working or sleeping</li>
  <li>Add a separate notification channel or webhooks for your spouse or family members (allowing for different conditions)</li>
  <li>Add a notification cooldown timer to prevent spamming (demonstrated below)</li>
  <li>Add a <a href="https://companion.home-assistant.io/docs/notifications/notification-sounds/">custom notification sound</a> like this one (⚠️ Light <em>Severance</em> Spoiler!):
    <ul>
      <li><a href="/assets/files/2025/05/Bird.wav">Bird.wav 🔊</a></li>
      <li><a href="/assets/files/2025/05/Bird.ogg">Bird.ogg 🔊</a></li>
    </ul>
  </li>
</ul>

<h3 id="notify-for-custom-species-detection">Notify for Custom Species Detection</h3>

<p>This first automation is a simple one that notifies me when a specific bird species is detected.</p>

<p>In BirdNET-Go, you can set up custom actions to run when a specific bird species is detected. I leverage this feature to execute a custom script. My script sends the detection information from BirdNET-Go to Home Assistant via a webhook.</p>

<p>On the Home Assistant side, I have an automation triggered by this webhook. It parses the incoming data payload and sends a notification to my phone.</p>

<p>By leveraging the custom species action in BirdNET-Go, I can get better real-time push notifications for specific bird species without polling the API and checking for changes. Although, I <em>am</em> already doing that for some of the cards… 🤷‍♂️ but I wrote this one first.</p>

<h4 id="custom-action-in-birdnet-go">Custom Action in BirdNET-Go</h4>

<p>This is the custom action that BirdNET-Go will execute when a specific bird species is detected.</p>

<p>Whenever you want to get notified for a bird detection, add a custom action under the <code class="language-plaintext highlighter-rouge">Settings &gt; Species</code> in BirdNET-Go that points to the script below. Then match it with the Home Assistant notification automation’s webhook further down.</p>

<p>Make sure to include the <code class="language-plaintext highlighter-rouge">CommonName</code>, <code class="language-plaintext highlighter-rouge">Confidence</code>, <code class="language-plaintext highlighter-rouge">Time</code>, and <code class="language-plaintext highlighter-rouge">Source</code> parameters in the custom action (any order will do).</p>

<blockquote>
  <p>Note: I’ve found that I need to restart my BirdNET-Go instance whenever I change the species settings (like adding a custom action).</p>
</blockquote>

<p><amp-img src="/assets/img/2025/05/birdnet-go-custom-action.png" alt="BirdNET-Go Custom Action for the White-crowned Sparrow" width="544" height="595" layout="responsive"><noscript><img src="/assets/img/2025/05/birdnet-go-custom-action.png" alt="BirdNET-Go Custom Action for the White-crowned Sparrow" width="544" height="595"></noscript></amp-img><em>BirdNET-Go Custom Action for the White-crowned Sparrow</em></p>

<details>

  <summary>[Shell script] BirdNET-Go Custom Action (notify Home Assistant)</summary>

  <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># version 1.0</span>

<span class="c"># === Debug: Log Raw Input Arguments ===</span>
<span class="nb">echo</span> <span class="s2">"--- Raw Script Arguments Received ---"</span> <span class="o">&gt;</span>&amp;2
<span class="nv">arg_count</span><span class="o">=</span>0
<span class="k">for </span>raw_arg <span class="k">in</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
  </span><span class="nv">arg_count</span><span class="o">=</span><span class="k">$((</span>arg_count <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
  <span class="nb">echo</span> <span class="s2">"Arg </span><span class="k">${</span><span class="nv">arg_count</span><span class="k">}</span><span class="s2">: </span><span class="k">${</span><span class="nv">raw_arg</span><span class="k">}</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2 <span class="c"># Print each argument exactly as received</span>
<span class="k">done
</span><span class="nb">echo</span> <span class="s2">"Total arguments received: </span><span class="k">${</span><span class="nv">arg_count</span><span class="k">}</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"-------------------------------------"</span> <span class="o">&gt;</span>&amp;2
<span class="c"># === End Debug ===</span>


<span class="c"># === Configuration ===</span>
<span class="nv">HA_WEBHOOK_URL</span><span class="o">=</span><span class="s2">"http://HOME_ASSISTANT_URL:8123/api/webhook/notify-bird-detection-123456789"</span> <span class="c"># Replace with your actual webhook URL</span>

<span class="c"># === Argument Parsing ===</span>
<span class="c"># Initialize variables to store argument values</span>
<span class="nv">COMMON_NAME_VAL</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">CONFIDENCE_VAL</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">SOURCE_VAL</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">TIME_VAL</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">MISSING_ARGS</span><span class="o">=</span><span class="s2">""</span> <span class="c"># Keep track of missing arguments</span>

<span class="c"># Loop through all provided arguments</span>
<span class="k">for </span>arg <span class="k">in</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
  case</span> <span class="nv">$arg</span> <span class="k">in</span>
    <span class="nt">--CommonName</span><span class="o">=</span><span class="k">*</span><span class="p">)</span>
      <span class="nv">COMMON_NAME_VAL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">arg</span><span class="p">#*=</span><span class="k">}</span><span class="s2">"</span> <span class="c"># Extract value after '='</span>
      <span class="c"># *** BUG FIX: Remove potential surrounding quotes from the value ***</span>
      <span class="nv">COMMON_NAME_VAL</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$COMMON_NAME_VAL</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'s/^"//'</span> <span class="nt">-e</span> <span class="s1">'s/"$//'</span> <span class="nt">-e</span> <span class="s2">"s/^'//"</span> <span class="nt">-e</span> <span class="s2">"s/'</span><span class="nv">$/</span><span class="s2">/"</span><span class="si">)</span>
      <span class="p">;;</span>
    <span class="nt">--Confidence</span><span class="o">=</span><span class="k">*</span><span class="p">)</span>
      <span class="nv">CONFIDENCE_VAL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">arg</span><span class="p">#*=</span><span class="k">}</span><span class="s2">"</span>
      <span class="c"># Optional: Remove quotes if confidence could ever be quoted</span>
      <span class="c"># CONFIDENCE_VAL=$(echo "$CONFIDENCE_VAL" | sed -e 's/^"//' -e 's/"$//' -e "s/^'//" -e "s/'$//")</span>
      <span class="p">;;</span>
    <span class="nt">--Source</span><span class="o">=</span><span class="k">*</span><span class="p">)</span>
      <span class="nv">SOURCE_VAL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">arg</span><span class="p">#*=</span><span class="k">}</span><span class="s2">"</span>
      <span class="c"># Optional: Remove quotes if source could ever be quoted</span>
      <span class="c"># SOURCE_VAL=$(echo "$SOURCE_VAL" | sed -e 's/^"//' -e 's/"$//' -e "s/^'//" -e "s/'$//")</span>
      <span class="p">;;</span>
    <span class="nt">--Time</span><span class="o">=</span><span class="k">*</span><span class="p">)</span>
      <span class="nv">TIME_VAL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">arg</span><span class="p">#*=</span><span class="k">}</span><span class="s2">"</span>
      <span class="c"># Optional: Remove quotes if time could ever be quoted</span>
      <span class="c"># TIME_VAL=$(echo "$TIME_VAL" | sed -e 's/^"//' -e 's/"$//' -e "s/^'//" -e "s/'$//")</span>
      <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span>
      <span class="nb">echo</span> <span class="s2">"WARNING: Ignoring unrecognized argument: </span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
      <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>

<span class="c"># === Validation ===</span>
<span class="c"># Check if all required arguments were found</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$COMMON_NAME_VAL</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nv">MISSING_ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MISSING_ARGS</span><span class="k">}</span><span class="s2"> --CommonName"</span><span class="p">;</span> <span class="k">fi
if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$CONFIDENCE_VAL</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nv">MISSING_ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MISSING_ARGS</span><span class="k">}</span><span class="s2"> --Confidence"</span><span class="p">;</span> <span class="k">fi
if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$SOURCE_VAL</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nv">MISSING_ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MISSING_ARGS</span><span class="k">}</span><span class="s2"> --Source"</span><span class="p">;</span> <span class="k">fi
if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$TIME_VAL</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nv">MISSING_ARGS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">MISSING_ARGS</span><span class="k">}</span><span class="s2"> --Time"</span><span class="p">;</span> <span class="k">fi</span>

<span class="c"># If any arguments are missing...</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$MISSING_ARGS</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># --- Debug Fallback ---</span>
    <span class="nv">ERROR_REASON</span><span class="o">=</span><span class="s2">"Missing required arguments"</span>
    <span class="nb">echo</span> <span class="s2">"ERROR: </span><span class="k">${</span><span class="nv">ERROR_REASON</span><span class="k">}</span><span class="s2">: </span><span class="k">${</span><span class="nv">MISSING_ARGS</span><span class="k">}</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2

    <span class="c"># Construct a debug JSON payload for Home Assistant</span>
    <span class="nv">DEBUG_JSON</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'{"type": "script_error", "reason": "%s", "missing_args": "%s"}'</span> <span class="se">\</span>
        <span class="s2">"</span><span class="nv">$ERROR_REASON</span><span class="s2">"</span> <span class="se">\</span>
        <span class="s2">"</span><span class="k">${</span><span class="nv">MISSING_ARGS</span><span class="p"># </span><span class="k">}</span><span class="s2">"</span> <span class="si">)</span> <span class="c"># Remove leading space from MISSING_ARGS</span>

    <span class="nb">echo</span> <span class="s2">"Sending error details to Home Assistant webhook..."</span> <span class="o">&gt;</span>&amp;2

    <span class="c"># Attempt to send the error notification via curl to the HA webhook</span>
    curl <span class="nt">--silent</span> <span class="nt">--show-error</span> <span class="nt">--fail</span> <span class="se">\</span>
        <span class="nt">-X</span> POST <span class="se">\</span>
        <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
        <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$DEBUG_JSON</span><span class="s2">"</span> <span class="se">\</span>
        <span class="s2">"</span><span class="k">${</span><span class="nv">HA_WEBHOOK_URL</span><span class="k">}</span><span class="s2">"</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to send *debug* JSON to Home Assistant webhook."</span> <span class="o">&gt;</span>&amp;2
        <span class="c"># Even if sending debug fails, we continue to exit 0 below</span>
    <span class="k">fi</span>

    <span class="c"># Print standard usage instructions to console for the user</span>
    <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> --Time=</span><span class="se">\"</span><span class="s2">&lt;value&gt;</span><span class="se">\"</span><span class="s2"> --CommonName=</span><span class="se">\"</span><span class="s2">&lt;value&gt;</span><span class="se">\"</span><span class="s2"> --Confidence=</span><span class="se">\"</span><span class="s2">&lt;value&gt;</span><span class="se">\"</span><span class="s2"> --Source=</span><span class="se">\"</span><span class="s2">&lt;value&gt;</span><span class="se">\"</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"Arguments can be in any order."</span>
    <span class="nb">echo</span> <span class="s2">"Example: </span><span class="nv">$0</span><span class="s2"> --Time=</span><span class="se">\"</span><span class="s2">07:53:30</span><span class="se">\"</span><span class="s2"> --CommonName=</span><span class="se">\"</span><span class="s2">White-crowned Sparrow</span><span class="se">\"</span><span class="s2"> --Confidence=</span><span class="se">\"</span><span class="s2">0.54</span><span class="se">\"</span><span class="s2"> --Source=</span><span class="se">\"</span><span class="s2">rtsp://user@10.0.0.1/stream</span><span class="se">\"</span><span class="s2">"</span>

    <span class="c"># Exit with a success status code, even though curl failed, that way nothing downstream breaks</span>
    <span class="nb">echo</span> <span class="s2">"Exiting with status 0 despite missing arguments."</span> <span class="o">&gt;</span>&amp;2
    <span class="nb">exit </span>0
<span class="k">fi</span>

<span class="c"># === Normal Operation (if all arguments are present) ===</span>

<span class="c"># --- Source Mapping ---</span>
<span class="c"># Use a temporary variable for the source before mapping</span>
<span class="c"># This remaps and source that contains the IP and replaces the entire source with a friendly name</span>
<span class="nv">SOURCE_MAPPED</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SOURCE_VAL</span><span class="s2">"</span>
<span class="c"># Check if the source value CONTAINS a known IP using pattern matching (*)</span>
<span class="k">case</span> <span class="s2">"</span><span class="nv">$SOURCE_VAL</span><span class="s2">"</span> <span class="k">in</span>
    <span class="k">*</span><span class="s2">"10.0.0.1"</span><span class="k">*</span><span class="p">)</span> <span class="nv">SOURCE_MAPPED</span><span class="o">=</span><span class="s2">"Pool Camera"</span> <span class="p">;;</span>
    <span class="k">*</span><span class="s2">"10.0.0.2"</span><span class="k">*</span><span class="p">)</span> <span class="nv">SOURCE_MAPPED</span><span class="o">=</span><span class="s2">"Tree Camera"</span> <span class="p">;;</span>
    <span class="k">*</span><span class="s2">"10.0.0.3"</span><span class="k">*</span><span class="p">)</span> <span class="nv">SOURCE_MAPPED</span><span class="o">=</span><span class="s2">"Spy Camera"</span> <span class="p">;;</span>
<span class="k">esac</span>
<span class="c"># --- End Source Mapping ---</span>

<span class="c"># --- Confidence Formatting ---</span>
<span class="c"># Convert decimal confidence to percentage string</span>
<span class="nv">CONFIDENCE_DISPLAY</span><span class="o">=</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">conf</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CONFIDENCE_VAL</span><span class="s2">"</span> <span class="s1">'BEGIN { printf "%.0f%%", conf * 100 }'</span><span class="si">)</span>
<span class="c"># --- End Confidence Formatting ---</span>

<span class="c"># === JSON Construction ===</span>
<span class="c"># Create the JSON payload for Home Assistant</span>
<span class="nv">JSON_PAYLOAD</span><span class="o">=</span><span class="si">$(</span><span class="nb">printf</span> <span class="s1">'{"type": "bird_detection", "time": "%s", "common_name": "%s", "confidence_pct": "%s", "confidence_raw": "%s", "source_camera": "%s"}'</span> <span class="se">\</span>
    <span class="s2">"</span><span class="nv">$TIME_VAL</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="nv">$COMMON_NAME_VAL</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="nv">$CONFIDENCE_DISPLAY</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="nv">$CONFIDENCE_VAL</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="nv">$SOURCE_MAPPED</span><span class="s2">"</span> <span class="si">)</span>

<span class="c"># === Send Data to Home Assistant ===</span>
<span class="nb">echo</span> <span class="s2">"Sending data to Home Assistant webhook..."</span>

<span class="c"># --- Debug: Show Final Values Before Sending ---</span>
<span class="nb">echo</span> <span class="s2">"--- Values used in JSON ---"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"Time:           </span><span class="nv">$TIME_VAL</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"Common Name:    </span><span class="nv">$COMMON_NAME_VAL</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"Confidence Pct: </span><span class="nv">$CONFIDENCE_DISPLAY</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"Confidence Raw: </span><span class="nv">$CONFIDENCE_VAL</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"Source Mapped:  </span><span class="nv">$SOURCE_MAPPED</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"---------------------------"</span> <span class="o">&gt;</span>&amp;2
<span class="nb">echo</span> <span class="s2">"JSON Payload: </span><span class="nv">$JSON_PAYLOAD</span><span class="s2">"</span> <span class="c"># Print the final JSON</span>
<span class="c"># --- End Debug ---</span>


<span class="c"># Use curl to send the JSON payload via POST</span>
curl <span class="nt">--silent</span> <span class="nt">--show-error</span> <span class="nt">--fail</span> <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="se">\</span>
    <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$JSON_PAYLOAD</span><span class="s2">"</span> <span class="se">\</span>
    <span class="s2">"</span><span class="k">${</span><span class="nv">HA_WEBHOOK_URL</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># === Check Result ===</span>
<span class="nv">CURL_EXIT_CODE</span><span class="o">=</span><span class="nv">$?</span> <span class="c"># Capture the exit code of curl</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$CURL_EXIT_CODE</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Data sent successfully to Home Assistant webhook."</span>
    <span class="nb">exit </span>0 <span class="c"># Success exit code</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to send data to Home Assistant webhook (curl exit code: </span><span class="nv">$CURL_EXIT_CODE</span><span class="s2">)."</span> <span class="o">&gt;</span>&amp;2
    <span class="c"># Exit with a success status code, even though curl failed, that way nothing downstream breaks</span>
    <span class="nb">echo</span> <span class="s2">"Exiting with status 0 despite webhook send failure."</span> <span class="o">&gt;</span>&amp;2
    <span class="nb">exit </span>0
<span class="k">fi</span>
</code></pre></div>  </div>

</details>

<h4 id="notification-for-a-bird-triggered-by-birdnet-go-script">Notification: For A Bird Triggered by BirdNET-Go Script</h4>

<p><amp-img src="/assets/img/2025/05/home_assistant_notification_tracked_bird_detected.png" alt="Home Assistant notification showing a notification for a detection of a tracked bird" width="400" height="211" layout="responsive"><noscript><img src="/assets/img/2025/05/home_assistant_notification_tracked_bird_detected.png" alt="Home Assistant notification showing a notification for a detection of a tracked bird" width="400" height="211"></noscript></amp-img><em>Home Assistant notification for the detection of a tracked bird</em></p>

<p>This is the code for the Home Assistant automation that listens for the webhook from BirdNET-Go and sends a notification to my phone.</p>

<p>For the automation below, I created a timer to prevent multiple notifications from being sent in a short period. I personally use a 15-minute cooldown between new notifications <em>unless</em> I press the <code class="language-plaintext highlighter-rouge">Reset</code> button in the notification. That button will trigger a reset of the notification cooldown timer.</p>

<p>This is useful if you have multiple cameras and they all detect the same bird at the same time, or if you want to get an additional notification while you’re trying to spot the bird with your binoculars up.</p>

<p>If you want to include the timer:</p>
<ul>
  <li>Create a new timer in the Helpers UI:
    <ul>
      <li>
<a href="https://my.home-assistant.io/redirect/helpers/" target="_blank" rel="noreferrer noopener"><amp-img src="https://my.home-assistant.io/badges/helpers.svg" alt="Open your Home Assistant instance and show your helper entities." style="margin-left: unset" width="173.75" height="40" layout="responsive"><noscript><img src="https://my.home-assistant.io/badges/helpers.svg" alt="Open your Home Assistant instance and show your helper entities." style="margin-left: unset" width="173.75" height="40"></noscript></amp-img></a> <!-- https://my.home-assistant.io/create-link/ -->
</li>
      <li>I set the timer duration to 15 minutes</li>
    </ul>
  </li>
  <li>Add the <code class="language-plaintext highlighter-rouge">Notify Bird Detection</code> automation below
    <ul>
      <li>Update the <code class="language-plaintext highlighter-rouge">timer.kyle_bird_notification_cooldown</code> to <em>your</em> new timer <code class="language-plaintext highlighter-rouge">entity_id</code>
</li>
    </ul>
  </li>
  <li>Add the <code class="language-plaintext highlighter-rouge">Reset Bird Detection Timer</code> automation below
    <ul>
      <li>Update the <code class="language-plaintext highlighter-rouge">timer.kyle_bird_notification_cooldown</code> to <em>your</em> new timer <code class="language-plaintext highlighter-rouge">entity_id</code>
</li>
    </ul>
  </li>
</ul>

<p><strong>⚠️ Known downside:</strong> Since this script is intended for <em>any</em> trigger by BirdNET-Go, all bird species that hit my webhook endpoint end up grouped together. So if BirdNET-Go hits my automation webhook endpoint for two different birds <em>during</em> the timer cooldown, I’ll miss the notification for the second bird. I’ve accepted this as a drawback because the tradeoff for having a single automation for multiple birds is worth it to me.</p>

<p>Here are a few ideas to work around this limitation:</p>

<ul>
  <li>Ignore the timer cooldown</li>
  <li>Create a separate automation for each bird species you want to track</li>
  <li>Create a managed filter entity inside Home Assistant that uses state triggers and records the species</li>
</ul>

<p>But I didn’t bother with any of that because the chances of two different birds that I’m tracking being detected at the same time are low, and I’m probably already outside listening for the first bird.</p>

<details>

  <summary>[Yaml] Home Assistant Automation - Notify Bird Detection</summary>

  <p><a href="https://my.home-assistant.io/redirect/automations/" target="_blank" rel="noreferrer noopener"><amp-img src="https://my.home-assistant.io/badges/automations.svg" alt="Open your Home Assistant instance and show your automations." style="margin-left: unset" width="217.08333333333331" height="40" layout="responsive"><noscript><img src="https://my.home-assistant.io/badges/automations.svg" alt="Open your Home Assistant instance and show your automations." style="margin-left: unset" width="217.08333333333331" height="40"></noscript></amp-img></a> <!-- https://my.home-assistant.io/create-link/ --></p>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.0</span>
<span class="na">alias</span><span class="pi">:</span> <span class="s">Notify Bird Detection</span>
<span class="na">description</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">Sends a notification to Kyle when the bird detection script calls the webhook,</span>
  <span class="s">handling success and error cases.</span>
<span class="na">triggers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span> <span class="s">webhook</span>
    <span class="na">allowed_methods</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POST</span>
      <span class="pi">-</span> <span class="s">PUT</span>
    <span class="na">local_only</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">webhook_id</span><span class="pi">:</span> <span class="s">notify-bird-detection-123456789</span>
<span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">choose</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">conditions</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">template</span>
            <span class="na">value_template</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">trigger.json.type</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">'bird_detection'</span><span class="nv"> </span><span class="s">}}"</span>
            <span class="na">alias</span><span class="pi">:</span> <span class="s">Bird Detection</span>
          <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">not</span>
            <span class="na">conditions</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">state</span>
                <span class="na">entity_id</span><span class="pi">:</span> <span class="s">timer.kyle_bird_notification_cooldown</span>
                <span class="na">state</span><span class="pi">:</span> <span class="s">active</span>
        <span class="na">sequence</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">parallel</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">data</span><span class="pi">:</span>
                  <span class="na">title</span><span class="pi">:</span> <span class="s">🦜 {{ trigger.json.common_name }} Detected!</span>
                  <span class="na">message</span><span class="pi">:</span> <span class="pi">|</span>
                    <span class="s">Time: {{ trigger.json.time }}   </span>
                    <span class="s">Camera: {{ trigger.json.source_camera }}  </span>
                    <span class="s">Confidence: {{ trigger.json.confidence_pct }}</span>
                  <span class="na">data</span><span class="pi">:</span>
                    <span class="na">notification_icon</span><span class="pi">:</span> <span class="s">mdi:bird</span>
                    <span class="na">group</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                    <span class="na">channel</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                    <span class="na">tag</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                    <span class="na">ttl</span><span class="pi">:</span> <span class="m">0</span>
                    <span class="na">priority</span><span class="pi">:</span> <span class="s">high</span>
                    <span class="na">push</span><span class="pi">:</span>
                      <span class="na">interruption-level</span><span class="pi">:</span> <span class="s">time-sensitive</span>
                      <span class="na">sound</span><span class="pi">:</span> <span class="s">bert.wav</span>
                    <span class="na">actions</span><span class="pi">:</span>
                      <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">BIRD_NOTIFICATION_COOLDOWN_RESET</span>
                        <span class="na">title</span><span class="pi">:</span> <span class="s">Reset</span>
                <span class="na">action</span><span class="pi">:</span> <span class="s">notify.kyle</span>
              <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">timer.start</span>
                <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
                <span class="na">data</span><span class="pi">:</span> <span class="pi">{}</span>
                <span class="na">target</span><span class="pi">:</span>
                  <span class="na">entity_id</span><span class="pi">:</span> <span class="s">timer.kyle_bird_notification_cooldown</span>
              <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">input_text.set_value</span>
                <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
                <span class="na">data</span><span class="pi">:</span>
                  <span class="na">value</span><span class="pi">:</span> <span class="pi">&gt;-</span>
                    <span class="s">{{ trigger.json.time }}: {{ trigger.json.common_name }}, {{</span>
                    <span class="s">trigger.json.source_camera }}, {{</span>
                    <span class="s">trigger.json.confidence_pct }}</span>
                <span class="na">target</span><span class="pi">:</span>
                  <span class="na">entity_id</span><span class="pi">:</span> <span class="s">input_text.kyle_last_bird_notification</span>
      <span class="pi">-</span> <span class="na">conditions</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">template</span>
            <span class="na">value_template</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">trigger.json.type</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">'script_error'</span><span class="nv"> </span><span class="s">}}"</span>
            <span class="na">alias</span><span class="pi">:</span> <span class="s">Script Error</span>
        <span class="na">sequence</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">data</span><span class="pi">:</span>
              <span class="na">message</span><span class="pi">:</span> <span class="pi">&gt;-</span>
                <span class="s">Received unexpected payload type from bird script webhook: {{</span>
                <span class="s">trigger.json | tojson }}</span>
              <span class="na">level</span><span class="pi">:</span> <span class="s">warning</span>
            <span class="na">action</span><span class="pi">:</span> <span class="s">system_log.write</span>
            <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="pi">-</span> <span class="na">data</span><span class="pi">:</span>
              <span class="na">title</span><span class="pi">:</span> <span class="s">Bird Script Error Reported</span>
              <span class="na">message</span><span class="pi">:</span> <span class="pi">&gt;</span>
                <span class="s">Reason: {{ trigger.json.reason }}   </span>

                <span class="s">Missing Args: {{ trigger.json.missing_args | default('None</span>
                <span class="s">specified') }}</span>
              <span class="na">data</span><span class="pi">:</span>
                <span class="na">notification_icon</span><span class="pi">:</span> <span class="s">mdi:bird</span>
                <span class="na">group</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                <span class="na">channel</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                <span class="na">tag</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                <span class="na">ttl</span><span class="pi">:</span> <span class="m">0</span>
                <span class="na">priority</span><span class="pi">:</span> <span class="s">high</span>
                <span class="na">push</span><span class="pi">:</span>
                  <span class="na">interruption-level</span><span class="pi">:</span> <span class="s">time-sensitive</span>
            <span class="na">action</span><span class="pi">:</span> <span class="s">notify.kyle</span>
<span class="na">mode</span><span class="pi">:</span> <span class="s">single</span>
</code></pre></div>  </div>

</details>

<details>

  <summary>[Yaml] Home Assistant Automation - Reset Bird Detection Timer</summary>

  <p><a href="https://my.home-assistant.io/redirect/automations/" target="_blank" rel="noreferrer noopener"><amp-img src="https://my.home-assistant.io/badges/automations.svg" alt="Open your Home Assistant instance and show your automations." style="margin-left: unset" width="217.08333333333331" height="40" layout="responsive"><noscript><img src="https://my.home-assistant.io/badges/automations.svg" alt="Open your Home Assistant instance and show your automations." style="margin-left: unset" width="217.08333333333331" height="40"></noscript></amp-img></a> <!-- https://my.home-assistant.io/create-link/ --></p>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.0</span>
<span class="na">alias</span><span class="pi">:</span> <span class="s">Kyle Bird Notification Cooldown Timer Reset</span>
<span class="na">description</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">Resets the Bird Notification Cooldown Timer so I can get another bird</span>
  <span class="s">notification.</span>
<span class="na">triggers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">event_type</span><span class="pi">:</span> <span class="s">mobile_app_notification_action</span>
    <span class="na">event_data</span><span class="pi">:</span>
      <span class="na">action</span><span class="pi">:</span> <span class="s">BIRD_NOTIFICATION_COOLDOWN_RESET</span>
    <span class="na">trigger</span><span class="pi">:</span> <span class="s">event</span>
<span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">timer.cancel</span>
    <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">data</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">target</span><span class="pi">:</span>
      <span class="na">entity_id</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">timer.kyle_bird_notification_cooldown</span>
<span class="na">mode</span><span class="pi">:</span> <span class="s">single</span>

</code></pre></div>  </div>

</details>

<h3 id="notify-for-a-bird-species-never-detected-before">Notify for a Bird Species Never Detected Before</h3>

<p><amp-img src="/assets/img/2025/05/home_assistant_notification_new_detection.png" alt="Home Assistant notification showing a notification for a bird species that is new" width="400" height="193" layout="responsive"><noscript><img src="/assets/img/2025/05/home_assistant_notification_new_detection.png" alt="Home Assistant notification showing a notification for a bird species that is new" width="400" height="193"></noscript></amp-img><em>Home Assistant notification for a bird species that has been detected for the first time</em></p>

<blockquote>
  <p>Requires: <a href="#sensor-for-overall-species-summary">Sensor for Overall Species Summary</a></p>
</blockquote>

<p>This automation will send a notification for each bird species the <em>first time</em> that BirdNET-Go detects it. This is just a neat little gimmick to know if there is a brand new bird species in the area that I haven’t seen before, or if I need to remove a false positive.</p>

<p>The downside is that this will only send a notification for each bird species <em>once</em> (as once it has been detected, it’s no longer <em>new</em> again). But it will certainly be a fun little treat when a new bird species is detected during the first year of running BirdNET-Go.</p>

<details>

  <summary>[Yaml] Home Assistant Automation - Notify First-Time Detection</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.1</span>
<span class="na">alias</span><span class="pi">:</span> <span class="s">Notify on First Detection of New BirdNET Bird Species</span>
<span class="na">description</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">Send a notification to kyle when a new bird species is detected that</span>
  <span class="s">we've never heard before.</span>
<span class="na">triggers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span> <span class="s">state</span>
    <span class="na">entity_id</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet_species_summary_persisted_data</span>
    <span class="na">attribute</span><span class="pi">:</span> <span class="s">species_list</span>
<span class="na">conditions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">template</span>
    <span class="na">value_template</span><span class="pi">:</span> <span class="pi">&gt;-</span>
      <span class="s">{{ trigger.to_state.attributes.species_list is defined and</span>
      <span class="s">trigger.to_state.attributes.species_list is iterable and</span>
      <span class="s">trigger.to_state.attributes.species_list is not string and</span>
      <span class="s">trigger.from_state.state != 'unavailable' }}</span>
<span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">variables</span><span class="pi">:</span>
      <span class="na">current_species_list</span><span class="pi">:</span> <span class="pi">&gt;-</span>
        <span class="s">{% set csl = trigger.to_state.attributes.get('species_list') if</span>
        <span class="s">trigger.to_state and trigger.to_state.attributes else none %} {% if csl</span>
        <span class="s">is iterable and csl is not string %}</span>
          <span class="s">{{ csl }}</span>
        <span class="s">{% else %}</span>
          <span class="s">[]</span>
        <span class="s">{% endif %}</span>
      <span class="na">previous_species_list</span><span class="pi">:</span> <span class="pi">&gt;-</span>
        <span class="s">{% set psl = trigger.from_state.attributes.get('species_list') if</span>
        <span class="s">trigger.from_state and trigger.from_state.attributes else none %} {% if</span>
        <span class="s">psl is iterable and psl is not string %}</span>
          <span class="s">{{ psl }}</span>
        <span class="s">{% else %}</span>
          <span class="s">[]</span>
        <span class="s">{% endif %}</span>
      <span class="na">current_common_names</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">current_species_list</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute='common_name')</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">previous_common_names</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">previous_species_list</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute='common_name')</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="na">repeat</span><span class="pi">:</span>
      <span class="na">for_each</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">current_species_list</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">sequence</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">sequence</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">template</span>
              <span class="na">value_template</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">repeat.item.common_name</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">previous_common_names</span><span class="nv"> </span><span class="s">}}"</span>
            <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">notify.kyle</span>
              <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
              <span class="na">data</span><span class="pi">:</span>
                <span class="na">title</span><span class="pi">:</span> <span class="s">🐦 New Bird Species Alert!</span>
                <span class="na">message</span><span class="pi">:</span> <span class="pi">&gt;-</span>
                  <span class="s">The {{repeat.item.common_name}} has been detected for the</span>
                  <span class="s">first time!</span>
                <span class="na">data</span><span class="pi">:</span>
                  <span class="na">notification_icon</span><span class="pi">:</span> <span class="s">mdi:bird</span>
                  <span class="na">group</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                  <span class="na">channel</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                  <span class="na">tag</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
                  <span class="na">ttl</span><span class="pi">:</span> <span class="m">0</span>
                  <span class="na">priority</span><span class="pi">:</span> <span class="s">high</span>
                  <span class="na">push</span><span class="pi">:</span>
                    <span class="na">interruption-level</span><span class="pi">:</span> <span class="s">time-sensitive</span>
<span class="na">mode</span><span class="pi">:</span> <span class="s">single</span>
</code></pre></div>  </div>

</details>

<h3 id="notify-for-a-bird-that-hasnt-been-detected-in-a-while">Notify for a Bird That Hasn’t Been Detected in a While</h3>

<p><amp-img src="/assets/img/2025/05/home_assistant_notification_bird_returned.png" alt="Home Assistant notification showing a notification for a bird that hasn't been detected in a while" width="400" height="228" layout="responsive"><noscript><img src="/assets/img/2025/05/home_assistant_notification_bird_returned.png" alt="Home Assistant notification showing a notification for a bird that hasn't been detected in a while" width="400" height="228"></noscript></amp-img><em>Home Assistant notification for any bird that hasn’t been detected for a while</em></p>

<blockquote>
  <p>Requires: <a href="#sensor-for-overall-species-summary">Sensor for Overall Species Summary</a></p>
</blockquote>

<p>Over time, the BirdNET-Go instance will stop accumulating <em>brand new</em> birds as it detects more and more species. But I still want to know when a bird that hasn’t been detected in a while is detected again.</p>

<p>To solve this problem, I created an automation that notifies me when a bird that hasn’t been detected in a while is detected again. Think of it like the first time you see a yellow-rumped warbler in the spring after not seeing it all winter. It’s neat to be notified when any bird is back in the area after a long absence.</p>

<p>By default, the automation sets a window of 60 days. As I’ve only had my BirdNET-Go instance running for a couple of months, I have no idea if this is a sane number or not. But I’ll find out!</p>

<p>This can easily be adjusted in the automation below on the <code class="language-plaintext highlighter-rouge">{{ difference_in_days &gt; 60 }}</code> line.</p>

<details>

  <summary>[Yaml] Home Assistant Automation - Notify Uncommon Detection</summary>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># version 1.4</span>
<span class="na">alias</span><span class="pi">:</span> <span class="s">Notify rare bird detection</span>
<span class="na">description</span><span class="pi">:</span> <span class="pi">&gt;-</span>
  <span class="s">Notify the family when a bird that hasn't been detected for a large number of days</span>
  <span class="s">is detected again.</span>
<span class="na">triggers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span> <span class="s">state</span>
    <span class="na">entity_id</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">sensor.birdnet_species_summary_persisted_data</span>
    <span class="na">attribute</span><span class="pi">:</span> <span class="s">species_list</span>
<span class="na">conditions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">template</span>
    <span class="na">value_template</span><span class="pi">:</span> <span class="pi">&gt;-</span>
      <span class="s">{{ trigger.to_state.attributes.species_list is defined and</span>
      <span class="s">trigger.to_state.attributes.species_list is iterable and</span>
      <span class="s">trigger.to_state.attributes.species_list is not string and</span>
      <span class="s">trigger.from_state.state != 'unavailable' }}</span>
    <span class="na">alias</span><span class="pi">:</span> <span class="s">Is a valid list</span>
<span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">variables</span><span class="pi">:</span>
      <span class="na">current_species_list</span><span class="pi">:</span> <span class="pi">&gt;-</span>
        <span class="s">{% set csl = trigger.to_state.attributes.get('species_list') if</span>
        <span class="s">trigger.to_state and trigger.to_state.attributes else none %} {% if csl</span>
        <span class="s">is iterable and csl is not string %}</span>
          <span class="s">{{ csl }}</span>
        <span class="s">{% else %}</span>
          <span class="s">[]</span>
        <span class="s">{% endif %}</span>
      <span class="na">previous_species_list</span><span class="pi">:</span> <span class="pi">&gt;-</span>
        <span class="s">{% set psl = trigger.from_state.attributes.get('species_list') if</span>
        <span class="s">trigger.from_state and trigger.from_state.attributes else none %} {% if</span>
        <span class="s">psl is iterable and psl is not string %}</span>
          <span class="s">{{ psl }}</span>
        <span class="s">{% else %}</span>
          <span class="s">[]</span>
        <span class="s">{% endif %}</span>
      <span class="na">current_common_names</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">current_species_list</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute='common_name')</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">previous_common_names</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">previous_species_list</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute='common_name')</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="na">repeat</span><span class="pi">:</span>
      <span class="na">for_each</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">current_species_list</span><span class="nv"> </span><span class="s">}}"</span>
      <span class="na">sequence</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">template</span>
          <span class="na">value_template</span><span class="pi">:</span> <span class="pi">&gt;-</span>
            <span class="s">{{ previous_species_list | selectattr('species_code', 'eq',</span>
            <span class="s">repeat.item.species_code) | list | length &gt; 0 }}</span>
        <span class="pi">-</span> <span class="na">condition</span><span class="pi">:</span> <span class="s">template</span>
          <span class="na">value_template</span><span class="pi">:</span> <span class="pi">&gt;-</span>
            <span class="s">{% set current_bird = repeat.item %}</span>

            <span class="s">{% set previous_bird_data_list = previous_species_list |</span>
            <span class="s">selectattr('species_code', 'eq', current_bird.species_code) | list</span>
            <span class="s">%}</span>

            <span class="s">{% if previous_bird_data_list | length &gt; 0 %}</span>
              <span class="s">{% set previous_bird = previous_bird_data_list[0] %}</span>

              <span class="s">{% if current_bird.last_heard is defined and current_bird.last_heard is string and </span>
                    <span class="s">previous_bird.last_heard is defined and previous_bird.last_heard is string %}</span>
            <span class="no">    </span>
                <span class="s">{% set current_last_heard_dt = strptime(current_bird.last_heard, '%Y-%m-%d %H:%M:%S') %}</span>
                <span class="s">{% set previous_last_heard_dt = strptime(previous_bird.last_heard, '%Y-%m-%d %H:%M:%S') %}</span>

                <span class="s">{% if current_last_heard_dt &gt; previous_last_heard_dt %}</span>
                  <span class="s">{% set difference_in_seconds = (current_last_heard_dt - previous_last_heard_dt).total_seconds() %}</span>
                  <span class="s">{% set difference_in_days = difference_in_seconds / (60*60*24) %}</span>
                  <span class="s">{{ difference_in_days &gt; 180 }}</span>
                <span class="s">{% else %}</span>
                  <span class="s">{# current_last_heard is not more recent than previous_last_heard #}</span>
                  <span class="s">false</span>
                <span class="s">{% endif %}</span>
              <span class="s">{% else %}</span>
                <span class="s">false</span>
              <span class="s">{% endif %}</span>
            <span class="s">{% else %}</span>
              <span class="s">false</span>
            <span class="s">{% endif %}</span>
        <span class="pi">-</span> <span class="na">variables</span><span class="pi">:</span>
            <span class="na">bird_last_heard</span><span class="pi">:</span> <span class="pi">&gt;-</span>
              <span class="s">{{ (previous_species_list | selectattr('species_code', 'eq',</span>
              <span class="s">repeat.item.species_code) | list)[0].last_heard }}</span>
            <span class="na">bird_recently_heard</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">repeat.item.last_heard</span><span class="nv"> </span><span class="s">}}"</span>
            <span class="na">days_between_detection</span><span class="pi">:</span> <span class="pi">&gt;-</span>
              <span class="s">{{ (bird_recently_heard | as_datetime - bird_last_heard |</span>
              <span class="s">as_datetime).days }}</span>
        <span class="pi">-</span> <span class="na">data</span><span class="pi">:</span>
            <span class="na">title</span><span class="pi">:</span> <span class="pi">&gt;-</span>
              <span class="s">🐦 {{ repeat.item.common_name }} is back</span>
              <span class="s">({{days_between_detection}} days)!</span>
            <span class="na">message</span><span class="pi">:</span> <span class="pi">|</span>
              <span class="s">{{ repeat.item.common_name }} has been heard again!</span>
              <span class="s">Previously heard: {{ bird_last_heard | as_timestamp |</span>
              <span class="s">timestamp_custom('%b %d, %Y') }}</span>
              <span class="s">That's a gap of {{ days_between_detection }} days!</span>
            <span class="na">data</span><span class="pi">:</span>
              <span class="na">notification_icon</span><span class="pi">:</span> <span class="s">mdi:bird</span>
              <span class="na">group</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
              <span class="na">channel</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
              <span class="na">tag</span><span class="pi">:</span> <span class="s">birdnet-alert</span>
              <span class="na">ttl</span><span class="pi">:</span> <span class="m">0</span>
              <span class="na">priority</span><span class="pi">:</span> <span class="s">high</span>
              <span class="na">push</span><span class="pi">:</span>
                <span class="na">interruption-level</span><span class="pi">:</span> <span class="s">time-sensitive</span>
          <span class="na">action</span><span class="pi">:</span> <span class="s">notify.kyle</span>
<span class="c1"># Queued as we might be running slow with our timestamp</span>
<span class="na">mode</span><span class="pi">:</span> <span class="s">queued</span>
<span class="na">max</span><span class="pi">:</span> <span class="m">10</span>
</code></pre></div>  </div>

</details>

<h2 id="bonus-generate-shareable-videos-from-sound-detections">Bonus: Generate Shareable Videos From Sound Detections</h2>

<p>I’ve recorded some pretty cool bird sounds with BirdNET-Go, and I wanted to share them with my family and friends. Since it’s difficult to share raw audio files, I created a script that generates a video from the audio file, adds some metadata, and overlays some of the information.</p>

<p>Just so you’re aware, the audio download process from BirdNET-Go seems to be in flux at the moment depending on which page you download the audio from.</p>

<p>If you download the bird sounds from the audio player in the <code class="language-plaintext highlighter-rouge">Main Dashboard</code> or the <code class="language-plaintext highlighter-rouge">Search Bar</code> at the top of BirdNET-Go, it appears to download the <em>original</em> audio file from the <code class="language-plaintext highlighter-rouge">/api/v1/media/audio</code> endpoint. That audio file will follow a naming scheme close to <code class="language-plaintext highlighter-rouge">&lt;scientific_name&gt;_&lt;confidence&gt;_&lt;timestamp&gt;.&lt;original_extension&gt;</code>.</p>

<p>However, if you use the newer <code class="language-plaintext highlighter-rouge">Search Dashboard</code> (from the left-hand side of BirdNET-Go), you’ll be presented with a much more advanced search interface. This is what I’m using at the moment.</p>

<p>I’ve included both scripts below, but I commonly use the <code class="language-plaintext highlighter-rouge">Search Dashboard</code> one.</p>

<h3 id="new-search-dashboard-audio-files">New Search Dashboard Audio Files</h3>

<p>Filenames that match the <code class="language-plaintext highlighter-rouge">######.mp4</code> pattern and use the <code class="language-plaintext highlighter-rouge">/api/v2/audio/#####</code> endpoint.</p>

<details>

  <summary>[Shell script] BirdNET-Go Video Generator (New Search Dashboard)</summary>

  <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># version 1.0</span>

<span class="c"># Default values</span>
<span class="nv">duration</span><span class="o">=</span>15
<span class="nv">location</span><span class="o">=</span><span class="s2">"YOUR_OWN_LOCATION"</span>
<span class="nv">weather</span><span class="o">=</span><span class="s2">"Partly Cloudy"</span>
<span class="nv">input_file</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">ls</span> <span class="nt">-t</span> ~/Downloads/<span class="k">*</span>.mp4 2&gt;/dev/null | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="si">)</span><span class="s2">"</span>suppression
<span class="nv">boost_sound</span><span class="o">=</span><span class="nb">false
</span><span class="nv">species_override</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">subtitle</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">start_offset</span><span class="o">=</span><span class="s2">"0"</span> <span class="c"># Default start offset in seconds</span>
<span class="nv">api_detections_endpoint</span><span class="o">=</span><span class="s2">"http://YOUR_OWN_BIRDNET_ENDPOINT/api/v2/detections/"</span>

<span class="c"># === Dependency Check ===</span>
<span class="k">for </span>cmd <span class="k">in </span>curl jq ffmpeg <span class="nb">awk</span><span class="p">;</span> <span class="k">do
  if</span> <span class="o">!</span> <span class="nb">command</span> <span class="nt">-v</span> <span class="nv">$cmd</span> &amp;&gt; /dev/null<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Required command '</span><span class="nv">$cmd</span><span class="s2">' not found. Please install it."</span>
    <span class="nb">exit </span>1
  <span class="k">fi
done</span>
<span class="c"># === END Dependency Check ===</span>

<span class="c"># === Temp Directory and Cleanup ===</span>
<span class="nv">TMPDIR</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span><span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to create temporary directory."</span>
    <span class="nb">exit </span>1
<span class="k">fi
</span><span class="nb">trap</span> <span class="s1">'echo "DEBUG: Cleaning up temp dir: $TMPDIR"; rm -rf "$TMPDIR"'</span> EXIT
<span class="nb">echo</span> <span class="s2">"DEBUG: Created temp directory: </span><span class="nv">$TMPDIR</span><span class="s2">"</span>
<span class="c"># === END Temp Directory ===</span>

<span class="c"># Help function</span>
help_function<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> [options]"</span>
  <span class="nb">echo</span> <span class="s2">"Options:"</span>
  <span class="nb">echo</span> <span class="s2">"  -d &lt;duration&gt;       Duration of the video in seconds (default: 15)"</span>
  <span class="nb">echo</span> <span class="s2">"  -l &lt;location&gt;       Location (default: YOUR_OWN_LOCATION)"</span>
  <span class="nb">echo</span> <span class="s2">"  -w &lt;weather&gt;        Weather (default: Partly Cloudy)"</span>
  <span class="nb">echo</span> <span class="s2">"  -i &lt;input_file&gt;     Input audio/video file (default: newest .mp4 in ~/Downloads/)"</span>
  <span class="nb">echo</span> <span class="s2">"  -b &lt;boost_sound&gt;    Boost audio (true or false, default: false)"</span>
  <span class="nb">echo</span> <span class="s2">"  -s &lt;species_text&gt;   Override the species text displayed in the video"</span>
  <span class="nb">echo</span> <span class="s2">"  -u &lt;subtitle&gt;       Optional subtitle text below species name"</span>
  <span class="nb">echo</span> <span class="s2">"  -m &lt;start_offset&gt;   Start the clip at this many seconds into the input file (default: 0)"</span>
  <span class="nb">echo</span> <span class="s2">"  --help              Display this help message"</span>
  <span class="nb">exit </span>0
<span class="o">}</span>

<span class="c"># Parse command-line arguments</span>
<span class="k">while </span><span class="nb">getopts</span> <span class="s2">"d:l:w:i:b:s:u:m:"</span> opt<span class="p">;</span> <span class="k">do
  case</span> <span class="s2">"</span><span class="nv">$opt</span><span class="s2">"</span> <span class="k">in
  </span>d<span class="p">)</span> <span class="nv">duration</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  l<span class="p">)</span> <span class="nv">location</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  w<span class="p">)</span> <span class="nv">weather</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  i<span class="p">)</span> <span class="nv">input_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  b<span class="p">)</span> <span class="nv">boost_sound</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  s<span class="p">)</span> <span class="nv">species_override</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  u<span class="p">)</span> <span class="nv">subtitle</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  m<span class="p">)</span> <span class="nv">start_offset</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  <span class="se">\?</span><span class="p">|</span>: <span class="p">|</span> <span class="k">*</span><span class="p">)</span> help_function <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done
</span><span class="nb">shift</span> <span class="k">$((</span>OPTIND <span class="o">-</span> <span class="m">1</span><span class="k">))</span>

<span class="c"># Validate start_offset</span>
<span class="k">if</span> <span class="o">!</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$start_offset</span><span class="s2">"</span> <span class="o">=</span>~ ^[0-9]+<span class="o">([</span>.][0-9]+<span class="o">)</span>?<span class="nv">$ </span><span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Invalid start offset '</span><span class="nv">$start_offset</span><span class="s2">'. Must be a non-negative number."</span>
    <span class="nb">exit </span>1
<span class="k">fi
</span><span class="nb">echo</span> <span class="s2">"DEBUG: Start offset set to: </span><span class="nv">$start_offset</span><span class="s2"> seconds"</span>

<span class="c"># --- Input File and API Data Processing ---</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$input_file</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Error: No input file specified and couldn't find a default .mp4 file in ~/Downloads/."</span>
    <span class="nb">exit </span>1
<span class="k">fi
if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$input_file</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Error: Input file '</span><span class="nv">$input_file</span><span class="s2">' not found."</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi

</span><span class="nv">filename</span><span class="o">=</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$input_file</span><span class="s2">"</span><span class="si">)</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: Processing filename: </span><span class="nv">$filename</span><span class="s2">"</span>
<span class="nv">file_id</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">filename</span><span class="p">%.*</span><span class="k">}</span><span class="s2">"</span> <span class="c"># Get filename without extension</span>

<span class="k">if</span> <span class="o">!</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$file_id</span><span class="s2">"</span> <span class="o">=</span>~ ^[0-9]+<span class="nv">$ </span><span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Filename (without extension) '</span><span class="nv">$file_id</span><span class="s2">' is not a valid numeric ID."</span>
    <span class="nb">exit </span>1
<span class="k">fi
</span><span class="nb">echo</span> <span class="s2">"DEBUG: Extracted File ID: </span><span class="nv">$file_id</span><span class="s2">"</span>

<span class="nv">API_URL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$api_detections_endpoint$file_id</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: Fetching data from API: </span><span class="nv">$API_URL</span><span class="s2">"</span>

<span class="nv">api_response</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="nt">-L</span> <span class="s2">"</span><span class="nv">$API_URL</span><span class="s2">"</span><span class="si">)</span> <span class="c"># -L to follow redirects</span>
<span class="nv">curl_exit_status</span><span class="o">=</span><span class="nv">$?</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$curl_exit_status</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: curl command failed with exit status </span><span class="nv">$curl_exit_status</span><span class="s2"> when fetching data for ID </span><span class="nv">$file_id</span><span class="s2">."</span>
    <span class="nb">exit </span>1
<span class="k">fi

if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$api_response</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$api_response</span><span class="s2">"</span> | jq <span class="s1">'.id'</span><span class="si">)</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"null"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: API did not return valid data for ID </span><span class="nv">$file_id</span><span class="s2">. Response: </span><span class="nv">$api_response</span><span class="s2">"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Extract data using jq</span>
<span class="nv">api_common_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$api_response</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.commonName'</span><span class="si">)</span>
<span class="nv">api_begin_time</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$api_response</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.beginTime'</span><span class="si">)</span>
<span class="nv">api_confidence_float</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$api_response</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.confidence'</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$api_common_name</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"null"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$api_common_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Could not extract commonName from API response."</span>
    <span class="nb">exit </span>1
<span class="k">fi
if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$api_begin_time</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"null"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$api_begin_time</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Could not extract beginTime from API response."</span>
    <span class="nb">exit </span>1
<span class="k">fi
if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$api_confidence_float</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"null"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$api_confidence_float</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Could not extract confidence from API response."</span>
    <span class="nb">exit </span>1
<span class="k">fi

</span><span class="nb">echo</span> <span class="s2">"DEBUG: API Common Name: </span><span class="nv">$api_common_name</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: API Begin Time: </span><span class="nv">$api_begin_time</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: API Confidence (float): </span><span class="nv">$api_confidence_float</span><span class="s2">"</span>

<span class="c"># Format timestamp (e.g., YYYY-MM-DDTHH:MM:SS-04:00 -&gt; YYYY-MM-DD HH:MM:SS)</span>
<span class="nv">timestamp</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$api_begin_time</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/T/ /; s/\([-+][0-9][0-9]:[0-9][0-9]Z\{0,1\}\)$//'</span><span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$timestamp</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to format timestamp from API beginTime '</span><span class="nv">$api_begin_time</span><span class="s2">'."</span>
    <span class="nb">exit </span>1
<span class="k">fi
</span><span class="nb">echo</span> <span class="s2">"DEBUG: Formatted Timestamp: </span><span class="nv">$timestamp</span><span class="s2">"</span>

<span class="c"># Format confidence (e.g., 0.96 -&gt; 96% Confidence)</span>
<span class="nv">confidence_percentage</span><span class="o">=</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">conf</span><span class="o">=</span><span class="s2">"</span><span class="nv">$api_confidence_float</span><span class="s2">"</span> <span class="s1">'BEGIN { printf "%.0f", conf * 100 }'</span><span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$confidence_percentage</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to calculate confidence percentage from '</span><span class="nv">$api_confidence_float</span><span class="s2">'."</span>
    <span class="nb">exit </span>1
<span class="k">fi
</span><span class="nv">confidence_text_unescaped</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">confidence_percentage</span><span class="k">}</span><span class="s2">% Confidence"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: Confidence Text (unescaped): </span><span class="nv">$confidence_text_unescaped</span><span class="s2">"</span>
<span class="c"># --- End API Data Processing ---</span>

<span class="c"># Determine final species text</span>
<span class="nv">species_from_api</span><span class="o">=</span><span class="s2">"</span><span class="nv">$api_common_name</span><span class="s2">"</span> <span class="c"># Use common name from API</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$species_override</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"INFO: Using species override text: '</span><span class="nv">$species_override</span><span class="s2">'"</span>
  <span class="nv">final_species_text</span><span class="o">=</span><span class="s2">"</span><span class="nv">$species_override</span><span class="s2">"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"INFO: Using API-derived species text: '</span><span class="nv">$species_from_api</span><span class="s2">'"</span>
  <span class="nv">final_species_text</span><span class="o">=</span><span class="s2">"</span><span class="nv">$species_from_api</span><span class="s2">"</span>
<span class="k">fi
if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$final_species_text</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"ERROR: Species text is empty."</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi</span>

<span class="c"># Prepare other display text (unescaped) for textfile method</span>
<span class="nv">timestamp_display</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$timestamp</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/Z//g'</span><span class="si">)</span>
<span class="nv">weather_display</span><span class="o">=</span><span class="s2">"Weather: </span><span class="nv">$weather</span><span class="s2">"</span>

<span class="c"># --- Write text to temporary files (Using \% escape for files) ---</span>
<span class="nv">species_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/species.txt"</span>
<span class="nv">subtitle_file_path</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">confidence_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/confidence.txt"</span>
<span class="nv">location_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/location.txt"</span>
<span class="nv">timestamp_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/timestamp.txt"</span>
<span class="nv">weather_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/weather.txt"</span>

<span class="nb">echo</span> <span class="s2">"DEBUG: Writing text to temp files..."</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$final_species_text</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$species_file</span><span class="s2">"</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$location</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$location_file</span><span class="s2">"</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$timestamp_display</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$timestamp_file</span><span class="s2">"</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$weather_display</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$weather_file</span><span class="s2">"</span>

<span class="nv">confidence_text_for_file</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$confidence_text_unescaped</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/%/\\%/g'</span><span class="si">)</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$confidence_text_for_file</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$confidence_file</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: Confidence text written to </span><span class="nv">$confidence_file</span><span class="s2"> (using </span><span class="se">\%</span><span class="s2"> escape)"</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$subtitle</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">subtitle_file_path</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/subtitle_XXXXXX.txt"</span><span class="si">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$subtitle_file_path</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-w</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$subtitle_file_path</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to create subtitle temp file in </span><span class="nv">$TMPDIR</span><span class="s2">."</span>
        <span class="nv">subtitle_file_path</span><span class="o">=</span><span class="s2">""</span>
    <span class="k">else
        </span><span class="nv">subtitle_text_for_file</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$subtitle</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/%/\\%/g'</span><span class="si">)</span>
        <span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$subtitle_text_for_file</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$subtitle_file_path</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"DEBUG: Subtitle text written to </span><span class="nv">$subtitle_file_path</span><span class="s2"> (using </span><span class="se">\%</span><span class="s2"> escape)"</span>
    <span class="k">fi
fi</span>
<span class="c"># --- End Write text ---</span>


<span class="c"># &lt;&lt;&lt; Calculate Y Positions &gt;&gt;&gt;</span>
<span class="nv">y_offset_species</span><span class="o">=</span><span class="nt">-200</span><span class="p">;</span> <span class="nv">y_offset_confidence</span><span class="o">=</span><span class="nt">-115</span><span class="p">;</span> <span class="nv">y_offset_location</span><span class="o">=</span><span class="nt">-35</span><span class="p">;</span> <span class="nv">y_offset_timestamp</span><span class="o">=</span>45<span class="p">;</span> <span class="nv">y_offset_weather</span><span class="o">=</span>125<span class="p">;</span> <span class="nv">line_spacing</span><span class="o">=</span>85
calc_y_pos<span class="o">()</span> <span class="o">{</span> <span class="nb">local </span><span class="nv">offset</span><span class="o">=</span><span class="nv">$1</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"(h/2)-text_h/2+(</span><span class="nv">$offset</span><span class="s2">)"</span><span class="p">;</span> <span class="o">}</span>
<span class="nv">y_pos_species</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_species</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_confidence</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_confidence</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_location</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_location</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_timestamp</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_timestamp</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_weather</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_weather</span><span class="si">)</span>
<span class="nv">y_pos_subtitle</span><span class="o">=</span><span class="s2">""</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$subtitle_file_path</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nv">y_pos_subtitle</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_species <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_confidence</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_confidence <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_location</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_location <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_timestamp</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_timestamp <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_weather</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_weather <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
<span class="k">fi</span>
<span class="c"># &lt;&lt;&lt; END Calculate Y Positions &gt;&gt;&gt;</span>


<span class="c"># &lt;&lt;&lt; Build Filter Complex using textfile= for ALL lines &gt;&gt;&gt;</span>
<span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="se">\</span><span class="s2">
[0:v]drawtext=textfile='</span><span class="nv">$species_file</span><span class="s2">':fontcolor=white:fontsize=72:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_species</span><span class="k">}</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$subtitle_file_path</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$subtitle_file_path</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_subtitle</span><span class="k">}</span><span class="s2">"</span>
<span class="k">fi
</span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$confidence_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_confidence</span><span class="k">}</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$location_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_location</span><span class="k">}</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$timestamp_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_timestamp</span><span class="k">}</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$weather_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_weather</span><span class="k">}</span><span class="s2">[v]"</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$boost_sound</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">;[1:a]volume=15dB,compand=attacks=0:points=-80/-80|-12/-10|0/-2|20/25[a]"</span><span class="p">;</span> <span class="k">else </span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">;[1:a]anull[a]"</span><span class="p">;</span> <span class="k">fi</span>
<span class="c"># &lt;&lt;&lt; END Build Filter Complex &gt;&gt;&gt;</span>


<span class="c"># ============================================================</span>
<span class="c"># --- Construct the output path ---</span>
<span class="nv">input_dir</span><span class="o">=</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$input_file</span><span class="s2">"</span><span class="si">)</span>
<span class="nv">filename_species_part</span><span class="o">=</span><span class="s2">"</span><span class="nv">$final_species_text</span><span class="s2">"</span>
<span class="nv">safe_species_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$filename_species_part</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/[^a-zA-Z0-9_ -]//g'</span> | <span class="nb">tr</span> <span class="s1">' '</span> <span class="s1">'_'</span><span class="si">)</span>
<span class="nv">timestamp_filename</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$timestamp</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/ /_/g; s/:/-/g'</span><span class="si">)</span>
<span class="nv">output_filename_base</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">timestamp_filename</span><span class="k">}</span><span class="s2">_</span><span class="k">${</span><span class="nv">safe_species_name</span><span class="k">}</span><span class="s2">.mp4"</span>
<span class="nv">output_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$input_dir</span><span class="s2">/</span><span class="nv">$output_filename_base</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"INFO: Output file path: </span><span class="nv">$output_file</span><span class="s2">"</span>
<span class="c"># ============================================================</span>

<span class="c"># Construct the ffmpeg command string for eval</span>
<span class="nv">ffmpeg_input_options</span><span class="o">=</span><span class="s2">""</span>
<span class="c"># Check if start_offset is greater than 0 using awk for float comparison</span>
<span class="nv">is_offset_positive</span><span class="o">=</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">offset</span><span class="o">=</span><span class="s2">"</span><span class="nv">$start_offset</span><span class="s2">"</span> <span class="s1">'BEGIN { print (offset &gt; 0) }'</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$is_offset_positive</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">ffmpeg_input_options</span><span class="o">=</span><span class="s2">"-ss </span><span class="nv">$start_offset</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"INFO: Applying start offset of </span><span class="nv">$start_offset</span><span class="s2"> seconds to input file."</span>
<span class="k">fi

</span><span class="nv">ffmpeg_command</span><span class="o">=</span><span class="s2">"ffmpeg -f lavfi -i </span><span class="se">\"</span><span class="s2">color=c=black:s=1280x700</span><span class="se">\"</span><span class="s2"> </span><span class="nv">$ffmpeg_input_options</span><span class="s2"> -i </span><span class="se">\"</span><span class="nv">$input_file</span><span class="se">\"</span><span class="s2"> </span><span class="se">\</span><span class="s2">
-filter_complex </span><span class="se">\"</span><span class="nv">$filter_complex</span><span class="se">\"</span><span class="s2"> </span><span class="se">\</span><span class="s2">
-map </span><span class="se">\"</span><span class="s2">[v]</span><span class="se">\"</span><span class="s2"> -map </span><span class="se">\"</span><span class="s2">[a]</span><span class="se">\"</span><span class="s2"> -c:v libx264 -c:a aac -t </span><span class="nv">$duration</span><span class="s2"> -y </span><span class="se">\"</span><span class="nv">$output_file</span><span class="se">\"</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: FFmpeg command string built for eval: </span><span class="nv">$ffmpeg_command</span><span class="s2">"</span>

<span class="c"># Execute the command using eval</span>
<span class="nb">echo</span> <span class="s2">"INFO: Executing ffmpeg command..."</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="nv">$ffmpeg_command</span><span class="s2">"</span>

<span class="nv">exit_status</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$exit_status</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: ffmpeg command failed with exit status </span><span class="nv">$exit_status</span><span class="s2">"</span>
    <span class="nb">exit</span> <span class="nv">$exit_status</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"SUCCESS: Successfully created video: </span><span class="nv">$output_file</span><span class="s2">"</span>
<span class="k">fi

</span><span class="nb">exit </span>0
</code></pre></div>  </div>

</details>

<h3 id="legacy-search-dashboard-audio-files">Legacy Search Dashboard Audio Files</h3>

<p>Filenames that match the <code class="language-plaintext highlighter-rouge">&lt;scientific_name&gt;_&lt;confidence&gt;_&lt;timestamp&gt;.&lt;original_extension&gt;</code> pattern and use the <code class="language-plaintext highlighter-rouge">/api/v1/media/audio</code> endpoint.</p>

<blockquote>
  <p>This script requires a matching labels file in the same directory as the script. The labels file is used to translate the scientific name to a common name. Download the labels file from the <a href="https://github.com/birdnet-team/BirdNET-Analyzer/tree/v2.0.0/birdnet_analyzer/labels/V2.4">BirdNET-Go repository</a>.</p>

  <p>Or download their <code class="language-plaintext highlighter-rouge">BirdNET_GLOBAL_6K_V2.4_Labels_en_us.txt</code> file <a href="/assets/files/2025/05/BirdNET_GLOBAL_6K_V2.4_Labels_us_us.txt">here</a>.</p>
</blockquote>

<details>

  <summary>[Shell script] BirdNET-Go Video Generator (Legacy Search)</summary>

  <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># version 1.0</span>

<span class="c"># Default values</span>
<span class="nv">duration</span><span class="o">=</span>15
<span class="nv">location</span><span class="o">=</span><span class="s2">"Jenison, MI"</span>
<span class="nv">weather</span><span class="o">=</span><span class="s2">"Partly Cloudy"</span>
<span class="nv">input_file</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">ls</span> <span class="nt">-t</span> ~/Downloads/<span class="k">*</span>.m4a | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="si">)</span><span class="s2">"</span> <span class="c"># The default input file grabs the newest .m4a file in your Downloads folder</span>
<span class="nv">boost_sound</span><span class="o">=</span><span class="nb">false
</span><span class="nv">label_filename</span><span class="o">=</span><span class="s2">"BirdNET_GLOBAL_6K_V2.4_Labels_us_us.txt"</span> <span class="c"># Base filename</span>
<span class="nv">species_override</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">subtitle</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">start_offset</span><span class="o">=</span><span class="s2">"0"</span> <span class="c"># Default start offset in seconds</span>

<span class="c"># === Dependency Check ===</span>
<span class="k">for </span>cmd <span class="k">in </span>curl jq ffmpeg <span class="nb">awk</span><span class="p">;</span> <span class="k">do
  if</span> <span class="o">!</span> <span class="nb">command</span> <span class="nt">-v</span> <span class="nv">$cmd</span> &amp;&gt; /dev/null<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Required command '</span><span class="nv">$cmd</span><span class="s2">' not found. Please install it."</span>
    <span class="nb">exit </span>1
  <span class="k">fi
done</span>
<span class="c"># === END Dependency Check ===</span>

<span class="c"># === Temp Directory and Cleanup ===</span>
<span class="nv">TMPDIR</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span><span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to create temporary directory."</span>
    <span class="nb">exit </span>1
<span class="k">fi
</span><span class="nb">trap</span> <span class="s1">'echo "DEBUG: Cleaning up temp dir: $TMPDIR"; rm -rf "$TMPDIR"'</span> EXIT
<span class="nb">echo</span> <span class="s2">"DEBUG: Created temp directory: </span><span class="nv">$TMPDIR</span><span class="s2">"</span>
<span class="c"># === END Temp Directory ===</span>


<span class="c"># Determine script directory and build full label file path</span>
<span class="nv">SCRIPT_DIR</span><span class="o">=</span><span class="si">$(</span> <span class="nb">cd</span> <span class="nt">--</span> <span class="s2">"</span><span class="si">$(</span> <span class="nb">dirname</span> <span class="nt">--</span> <span class="s2">"</span><span class="k">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span> <span class="si">)</span><span class="s2">"</span> &amp;&gt; /dev/null <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="si">)</span>
<span class="nv">label_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/</span><span class="nv">$label_filename</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: Using label file path: </span><span class="nv">$label_file</span><span class="s2">"</span>


<span class="c"># Help function</span>
help_function<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> [options]"</span>
  <span class="nb">echo</span> <span class="s2">"Options:"</span>
  <span class="nb">echo</span> <span class="s2">"  -d &lt;duration&gt;      Duration of the video in seconds (default: 15)"</span>
  <span class="nb">echo</span> <span class="s2">"  -l &lt;location&gt;      Location (default: Jenison, MI)"</span>
  <span class="nb">echo</span> <span class="s2">"  -w &lt;weather&gt;       Weather (default: Partly Cloudy)"</span>
  <span class="nb">echo</span> <span class="s2">"  -i &lt;input_file&gt;    Input audio file (default: newest .m4a in ~/Downloads/)"</span>
  <span class="nb">echo</span> <span class="s2">"  -b &lt;boost_sound&gt;   Boost audio (true or false, default: false)"</span>
  <span class="nb">echo</span> <span class="s2">"  -s &lt;species_text&gt;  Override the species text displayed in the video"</span>
  <span class="nb">echo</span> <span class="s2">"  -m &lt;start_offset&gt;  Start the clip at this many seconds into the input file (default: 0)"</span>
  <span class="nb">echo</span> <span class="s2">"  -u &lt;subtitle&gt;      Optional subtitle text below species name"</span>
  <span class="nb">echo</span> <span class="s2">"  --help             Display this help message"</span>
  <span class="nb">exit </span>0
<span class="o">}</span>

<span class="c"># Parse command-line arguments</span>
<span class="k">while </span><span class="nb">getopts</span> <span class="s2">"d:l:w:i:b:s:u:m:"</span> opt<span class="p">;</span> <span class="k">do
  case</span> <span class="s2">"</span><span class="nv">$opt</span><span class="s2">"</span> <span class="k">in
  </span>d<span class="p">)</span> <span class="nv">duration</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  l<span class="p">)</span> <span class="nv">location</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  w<span class="p">)</span> <span class="nv">weather</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  i<span class="p">)</span> <span class="nv">input_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  b<span class="p">)</span> <span class="nv">boost_sound</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  s<span class="p">)</span> <span class="nv">species_override</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  u<span class="p">)</span> <span class="nv">subtitle</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  m<span class="p">)</span> <span class="nv">start_offset</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span> <span class="p">;;</span>
  <span class="se">\?</span><span class="p">|</span>: <span class="p">|</span> <span class="k">*</span><span class="p">)</span> help_function <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done
</span><span class="nb">shift</span> <span class="k">$((</span>OPTIND <span class="o">-</span> <span class="m">1</span><span class="k">))</span>

<span class="c"># Validate start_offset</span>
<span class="k">if</span> <span class="o">!</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$start_offset</span><span class="s2">"</span> <span class="o">=</span>~ ^[0-9]+<span class="o">([</span>.][0-9]+<span class="o">)</span>?<span class="nv">$ </span><span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"ERROR: Invalid start offset '</span><span class="nv">$start_offset</span><span class="s2">'. Must be a non-negative number."</span>
    <span class="nb">exit </span>1
<span class="k">fi
</span><span class="nb">echo</span> <span class="s2">"DEBUG: Start offset set to: </span><span class="nv">$start_offset</span><span class="s2"> seconds"</span>

<span class="c"># --- Filename Processing &amp; Extraction ---</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$input_file</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Error: Input file '</span><span class="nv">$input_file</span><span class="s2">' not found."</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi
</span><span class="nv">filename</span><span class="o">=</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$input_file</span><span class="s2">"</span><span class="si">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"Filename: </span><span class="nv">$filename</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$filename</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"ERROR: Could not get basename from '</span><span class="nv">$input_file</span><span class="s2">'"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi
</span><span class="nv">filename_parts</span><span class="o">=(</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$filename</span><span class="s2">"</span> | <span class="nb">tr</span> <span class="s1">'_'</span> <span class="s1">'\n'</span><span class="si">)</span><span class="o">)</span><span class="p">;</span> <span class="k">if</span> <span class="o">[</span> <span class="k">${#</span><span class="nv">filename_parts</span><span class="p">[@]</span><span class="k">}</span> <span class="nt">-lt</span> 2 <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"ERROR: Not enough parts in filename '</span><span class="nv">$filename</span><span class="s2">'"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi

</span><span class="nv">timestamp_with_extension</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">filename_parts</span><span class="p">[</span><span class="k">$((${#</span><span class="nv">filename_parts</span><span class="p">[@]</span><span class="k">}</span> <span class="o">-</span> <span class="m">1</span><span class="k">))</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="nv">timestamp_raw</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">timestamp_with_extension</span><span class="p">%.*</span><span class="k">}</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$timestamp_raw</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"ERROR: Could not extract raw timestamp"</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi
</span><span class="nb">echo</span> <span class="s2">"Timestamp raw: </span><span class="nv">$timestamp_raw</span><span class="s2">"</span><span class="p">;</span> <span class="nv">timestamp</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$timestamp_raw</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/T/ /g'</span> | <span class="nb">sed</span> <span class="s1">'s/\([0-9]\{4\}\)\([0-9]\{2\}\)\([0-9]\{2\}\) \([0-9]\{2\}\)\([0-9]\{2\}\)\([0-9]\{2\}\)/\1-\2-\3 \4:\5:\6/'</span><span class="si">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"Timestamp: </span><span class="nv">$timestamp</span><span class="s2">"</span>

<span class="nv">first_part</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">filename_parts</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="nv">num_parts</span><span class="o">=</span><span class="k">${#</span><span class="nv">filename_parts</span><span class="p">[@]</span><span class="k">}</span><span class="p">;</span> <span class="nv">confidence_index</span><span class="o">=</span><span class="k">$((</span>num_parts <span class="o">-</span> <span class="m">2</span><span class="k">))</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$first_part</span><span class="s2">"</span> <span class="o">=</span>~ ^[0-9]<span class="o">{</span>4<span class="o">}</span><span class="nv">$ </span><span class="o">&amp;&amp;</span> <span class="nv">$num_parts</span> <span class="nt">-ge</span> 6 <span class="o">]]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"DEBUG: Detected SCRIPTDIR/_MM_ format."</span><span class="p">;</span> <span class="nv">start_index</span><span class="o">=</span>2<span class="p">;</span> <span class="nv">length</span><span class="o">=</span><span class="k">$((</span>confidence_index <span class="o">-</span> start_index<span class="k">))</span><span class="p">;</span> <span class="k">else </span><span class="nb">echo</span> <span class="s2">"DEBUG: Assuming direct Genus_species_ format."</span><span class="p">;</span> <span class="nv">start_index</span><span class="o">=</span>0<span class="p">;</span> <span class="nv">length</span><span class="o">=</span><span class="k">$((</span>confidence_index <span class="o">-</span> start_index<span class="k">))</span><span class="p">;</span> <span class="k">fi
if</span> <span class="o">[[</span> <span class="nv">$length</span> <span class="nt">-lt</span> 1 <span class="o">]]</span><span class="p">;</span> <span class="k">then </span><span class="nv">scientific_name_parts</span><span class="o">=()</span><span class="p">;</span> <span class="k">else </span><span class="nv">scientific_name_parts</span><span class="o">=(</span><span class="s2">"</span><span class="k">${</span><span class="nv">filename_parts</span><span class="p">[@]</span>:<span class="nv">$start_index</span>:<span class="nv">$length</span><span class="k">}</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span> <span class="k">fi
if</span> <span class="o">[</span> <span class="k">${#</span><span class="nv">scientific_name_parts</span><span class="p">[@]</span><span class="k">}</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to extract scientific name parts."</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi
</span><span class="nv">scientific_name_underscores</span><span class="o">=</span><span class="si">$(</span><span class="nv">IFS</span><span class="o">=</span><span class="s1">'_'</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">scientific_name_parts</span><span class="p">[*]</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span>
<span class="nv">scientific_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$scientific_name_underscores</span><span class="s2">"</span> | <span class="nb">tr</span> <span class="s1">'_'</span> <span class="s1">' '</span><span class="si">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"Scientific name (underscores): </span><span class="nv">$scientific_name_underscores</span><span class="s2">"</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"Scientific name (spaces): </span><span class="nv">$scientific_name</span><span class="s2">"</span>

<span class="c"># Get numeric confidence and prepare UNESCAPED display string</span>
<span class="nv">confidence_part</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">filename_parts</span><span class="p">[</span><span class="nv">$confidence_index</span><span class="p">]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="nv">confidence_num_str</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$confidence_part</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/p//gi'</span> 2&gt;/dev/null<span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$confidence_num_str</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">!</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$confidence_num_str</span><span class="s2">"</span> <span class="o">=</span>~ ^[0-9]+<span class="o">(</span><span class="se">\.</span><span class="o">[</span>0-9]+<span class="o">)</span>?<span class="nv">$ </span><span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Warning: Confidence value '</span><span class="nv">$confidence_part</span><span class="s2">' invalid. Setting Unknown."</span>
    <span class="nv">confidence_text_unescaped</span><span class="o">=</span><span class="s2">"Unknown confidence"</span>
<span class="k">else
    </span><span class="nv">confidence_text_unescaped</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">confidence_num_str</span><span class="k">}</span><span class="s2">% Confidence"</span> <span class="c"># Literal text with single %</span>
<span class="k">fi</span><span class="p">;</span>
<span class="nb">echo</span> <span class="s2">"Confidence Text (unescaped): </span><span class="nv">$confidence_text_unescaped</span><span class="s2">"</span>
<span class="c"># --- End Filename Processing ---</span>


<span class="c"># Function to get common name from labels file</span>
get_common_name<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">scientific_name_key</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"Starting get_common_name with scientific name key: </span><span class="nv">$scientific_name_key</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
  <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-r</span> <span class="s2">"</span><span class="nv">$label_file</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Warning: Label file '</span><span class="nv">$label_file</span><span class="s2">' not found or not readable."</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$scientific_name</span><span class="s2">"</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="k">fi
  </span><span class="nb">local </span><span class="nv">common_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"^</span><span class="k">${</span><span class="nv">scientific_name_key</span><span class="k">}</span><span class="s2">_"</span> <span class="s2">"</span><span class="nv">$label_file</span><span class="s2">"</span> | <span class="nb">head</span> <span class="nt">-n</span> 1 | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'_'</span> <span class="nt">-f</span> 2<span class="si">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$common_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Match found: </span><span class="nv">$common_name</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$common_name</span><span class="s2">"</span><span class="p">;</span> <span class="k">else </span><span class="nb">echo</span> <span class="s2">"Species not found for key '</span><span class="nv">$scientific_name_key</span><span class="s2">'"</span> <span class="o">&gt;</span>&amp;2<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$scientific_name</span><span class="s2">"</span><span class="p">;</span> <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># Get common name</span>
<span class="nv">species</span><span class="o">=</span><span class="si">$(</span>get_common_name <span class="s2">"</span><span class="nv">$scientific_name</span><span class="s2">"</span><span class="si">)</span>
<span class="nb">echo</span> <span class="s2">"Species determined from file/lookup: </span><span class="nv">$species</span><span class="s2">"</span>

<span class="c"># Determine final species text</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$species_override</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"INFO: Using species override text: '</span><span class="nv">$species_override</span><span class="s2">'"</span>
  <span class="nv">final_species_text</span><span class="o">=</span><span class="s2">"</span><span class="nv">$species_override</span><span class="s2">"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"INFO: Using determined/fallback species text: '</span><span class="nv">$species</span><span class="s2">'"</span>
  <span class="nv">final_species_text</span><span class="o">=</span><span class="s2">"</span><span class="nv">$species</span><span class="s2">"</span>
<span class="k">fi
if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$final_species_text</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"ERROR: Species text is empty."</span><span class="p">;</span> <span class="nb">exit </span>1<span class="p">;</span> <span class="k">fi</span>

<span class="c"># Prepare other display text (unescaped) for textfile method</span>
<span class="nv">timestamp_display</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$timestamp</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/Z//g'</span><span class="si">)</span>
<span class="nv">weather_display</span><span class="o">=</span><span class="s2">"Weather: </span><span class="nv">$weather</span><span class="s2">"</span>

<span class="c"># --- Write text to temporary files (Using \% escape for files) ---</span>
<span class="nv">species_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/species.txt"</span>
<span class="nv">subtitle_file</span><span class="o">=</span><span class="s2">""</span> <span class="c"># Initialize</span>
<span class="nv">confidence_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/confidence.txt"</span>
<span class="nv">location_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/location.txt"</span>
<span class="nv">timestamp_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/timestamp.txt"</span>
<span class="nv">weather_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/weather.txt"</span>

<span class="nb">echo</span> <span class="s2">"DEBUG: Writing text to temp files..."</span>
<span class="c"># Species, Location, Timestamp, Weather written as is (apostrophes are OK here)</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$final_species_text</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$species_file</span><span class="s2">"</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$location</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$location_file</span><span class="s2">"</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$timestamp_display</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$timestamp_file</span><span class="s2">"</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$weather_display</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$weather_file</span><span class="s2">"</span>

<span class="c"># Replace single % with literal backslash + %</span>
<span class="nv">confidence_text_for_file</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$confidence_text_unescaped</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/%/\\%/g'</span><span class="si">)</span>
<span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$confidence_text_for_file</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$confidence_file</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"DEBUG: Confidence text written to </span><span class="nv">$confidence_file</span><span class="s2"> (using </span><span class="se">\%</span><span class="s2"> escape)"</span>

<span class="c"># Conditionally create subtitle file</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$subtitle</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">subtitle_file</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">/subtitle_XXXXXX.txt"</span><span class="si">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$subtitle_file</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-w</span> <span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$subtitle_file</span><span class="s2">"</span><span class="si">)</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
         </span><span class="nb">echo</span> <span class="s2">"ERROR: Failed to create subtitle temp file in </span><span class="nv">$TMPDIR</span><span class="s2">."</span>
         <span class="nv">subtitle_file</span><span class="o">=</span><span class="s2">""</span>
    <span class="k">else
        </span><span class="nv">subtitle_text_for_file</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$subtitle</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/%/\\%/g'</span><span class="si">)</span> <span class="c"># Use \%</span>
        <span class="nb">printf</span> <span class="s2">"%s"</span> <span class="s2">"</span><span class="nv">$subtitle_text_for_file</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$subtitle_file</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"DEBUG: Subtitle text written to </span><span class="nv">$subtitle_file</span><span class="s2"> (using </span><span class="se">\%</span><span class="s2"> escape)"</span>
    <span class="k">fi
fi</span>
<span class="c"># --- End Write text ---</span>


<span class="c"># &lt;&lt;&lt; Calculate Y Positions &gt;&gt;&gt;</span>
<span class="nv">y_offset_species</span><span class="o">=</span><span class="nt">-200</span><span class="p">;</span> <span class="nv">y_offset_confidence</span><span class="o">=</span><span class="nt">-115</span><span class="p">;</span> <span class="nv">y_offset_location</span><span class="o">=</span><span class="nt">-35</span><span class="p">;</span> <span class="nv">y_offset_timestamp</span><span class="o">=</span>45<span class="p">;</span> <span class="nv">y_offset_weather</span><span class="o">=</span>125<span class="p">;</span> <span class="nv">line_spacing</span><span class="o">=</span>85
calc_y_pos<span class="o">()</span> <span class="o">{</span> <span class="nb">local </span><span class="nv">offset</span><span class="o">=</span><span class="nv">$1</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"(h/2)-text_h/2+(</span><span class="nv">$offset</span><span class="s2">)"</span><span class="p">;</span> <span class="o">}</span>
<span class="nv">y_pos_species</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_species</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_confidence</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_confidence</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_location</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_location</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_timestamp</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_timestamp</span><span class="si">)</span><span class="p">;</span> <span class="nv">y_pos_weather</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="nv">$y_offset_weather</span><span class="si">)</span>
<span class="nv">y_pos_subtitle</span><span class="o">=</span><span class="s2">""</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$subtitle_file</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span> <span class="c"># Check if the subtitle file was successfully created</span>
    <span class="nv">y_pos_subtitle</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_species <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_confidence</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_confidence <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_location</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_location <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_timestamp</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_timestamp <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
    <span class="nv">y_pos_weather</span><span class="o">=</span><span class="si">$(</span>calc_y_pos <span class="k">$((</span>y_offset_weather <span class="o">+</span> line_spacing<span class="k">))</span><span class="si">)</span>
<span class="k">fi</span>
<span class="c"># &lt;&lt;&lt; END Calculate Y Positions &gt;&gt;&gt;</span>


<span class="c"># &lt;&lt;&lt; Build Filter Complex using textfile= for ALL lines &gt;&gt;&gt;</span>
<span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="se">\</span><span class="s2">
[0:v]drawtext=textfile='</span><span class="nv">$species_file</span><span class="s2">':fontcolor=white:fontsize=72:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_species</span><span class="k">}</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$subtitle_file</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$subtitle_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_subtitle</span><span class="k">}</span><span class="s2">"</span>
<span class="k">fi
</span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$confidence_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_confidence</span><span class="k">}</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$location_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_location</span><span class="k">}</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$timestamp_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_timestamp</span><span class="k">}</span><span class="s2">,</span><span class="se">\</span><span class="s2">
drawtext=textfile='</span><span class="nv">$weather_file</span><span class="s2">':fontcolor=white:fontsize=60:x=(w-text_w)/2:y=</span><span class="k">${</span><span class="nv">y_pos_weather</span><span class="k">}</span><span class="s2">[v]"</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$boost_sound</span><span class="s2">"</span> <span class="o">=</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">;[1:a]volume=15dB,compand=attacks=0:points=-80/-80|-12/-10|0/-2|20/25[a]"</span><span class="p">;</span> <span class="k">else </span><span class="nv">filter_complex</span><span class="o">=</span><span class="s2">"</span><span class="nv">$filter_complex</span><span class="s2">;[1:a]anull[a]"</span><span class="p">;</span> <span class="k">fi</span>
<span class="c"># &lt;&lt;&lt; END Build Filter Complex &gt;&gt;&gt;</span>


<span class="c"># ============================================================</span>
<span class="c"># --- Construct the output path ---</span>
<span class="nv">input_dir</span><span class="o">=</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$input_file</span><span class="s2">"</span><span class="si">)</span>
<span class="nv">filename_species_part</span><span class="o">=</span><span class="s2">"</span><span class="nv">$final_species_text</span><span class="s2">"</span>
<span class="nv">safe_species_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$filename_species_part</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/[^a-zA-Z0-9_ -]//g'</span> | <span class="nb">tr</span> <span class="s1">' '</span> <span class="s1">'_'</span><span class="si">)</span>
<span class="nv">timestamp_filename</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$timestamp</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s/ /_/g; s/:/-/g; s/Z//g'</span><span class="si">)</span>
<span class="nv">output_filename_base</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">timestamp_filename</span><span class="k">}</span><span class="s2">_</span><span class="k">${</span><span class="nv">safe_species_name</span><span class="k">}</span><span class="s2">.mp4"</span>
<span class="nv">output_file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$input_dir</span><span class="s2">/</span><span class="nv">$output_filename_base</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Output file path: </span><span class="nv">$output_file</span><span class="s2">"</span>
<span class="c"># ============================================================</span>

<span class="c"># Construct the ffmpeg command string for eval</span>
<span class="nv">ffmpeg_input_options</span><span class="o">=</span><span class="s2">""</span>
<span class="c"># Check if start_offset is greater than 0 using awk for float comparison</span>
<span class="nv">is_offset_positive</span><span class="o">=</span><span class="si">$(</span><span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">offset</span><span class="o">=</span><span class="s2">"</span><span class="nv">$start_offset</span><span class="s2">"</span> <span class="s1">'BEGIN { print (offset &gt; 0) }'</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$is_offset_positive</span><span class="s2">"</span> <span class="nt">-eq</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">ffmpeg_input_options</span><span class="o">=</span><span class="s2">"-ss </span><span class="nv">$start_offset</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"INFO: Applying start offset of </span><span class="nv">$start_offset</span><span class="s2"> seconds to input file."</span>
<span class="k">fi

</span><span class="nv">ffmpeg_command</span><span class="o">=</span><span class="s2">"ffmpeg -f lavfi -i </span><span class="se">\"</span><span class="s2">color=c=black:s=1280x700</span><span class="se">\"</span><span class="s2"> </span><span class="nv">$ffmpeg_input_options</span><span class="s2"> -i </span><span class="se">\"</span><span class="nv">$input_file</span><span class="se">\"</span><span class="s2"> </span><span class="se">\</span><span class="s2">
-filter_complex </span><span class="se">\"</span><span class="nv">$filter_complex</span><span class="se">\"</span><span class="s2"> </span><span class="se">\</span><span class="s2">
-map </span><span class="se">\"</span><span class="s2">[v]</span><span class="se">\"</span><span class="s2"> -map </span><span class="se">\"</span><span class="s2">[a]</span><span class="se">\"</span><span class="s2"> -c:v libx264 -c:a aac -t </span><span class="nv">$duration</span><span class="s2"> -y </span><span class="se">\"</span><span class="nv">$output_file</span><span class="se">\"</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"FFmpeg command string built for eval: </span><span class="nv">$ffmpeg_command</span><span class="s2">"</span>

<span class="c"># Execute the command using eval</span>
<span class="nb">echo</span> <span class="s2">"Executing via eval:"</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="nv">$ffmpeg_command</span><span class="s2">"</span>

<span class="nv">exit_status</span><span class="o">=</span><span class="nv">$?</span>
<span class="c"># Trap will clean up $TMPDIR regardless of exit status</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$exit_status</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Error: ffmpeg command failed with exit status </span><span class="nv">$exit_status</span><span class="s2">"</span>
    <span class="nb">exit</span> <span class="nv">$exit_status</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"Successfully created video: </span><span class="nv">$output_file</span><span class="s2">"</span>
<span class="k">fi

</span><span class="nb">exit </span>0
</code></pre></div>  </div>

</details>

<h2 id="favorite-bird-recordings">Favorite Bird Recordings</h2>

<p>Here are some of my favorite bird recordings I’ve captured on BirdNET-Go using my camera’s microphones <em>so far</em>.</p>

<h3 id="white-crowned-sparrow-">White-crowned Sparrow 🔊</h3>

<p><a href="https://ebird.org/species/whcspa">eBird species page</a></p>

<p>This small sparrow sings a beautiful song. In my region, I frequently hear it sing this earworm of a melody:</p>

<p>🎶 <em>Do-Do-Mi-Mi-Sol-Sol-La</em> 🎶</p>

<!-- Method to implement AMP-Video. -->

<amp-video height="420" width="700" poster="/assets/files/2025/05/2025-04-14_07-05-46_White-crowned_Sparrow.png" layout="responsive" controls="">
  <div fallback="">
    Your browser doesn't support HTML5 video
  </div>
  <source type="video/mp4" src="/assets/files/2025/05/2025-04-14_07-05-46_White-crowned_Sparrow.mp4"></source>
</amp-video>

<p><code class="language-plaintext highlighter-rouge">bird-video.sh -i ~/Downloads/29722.mp4 -b true -d 3 -w "Cloudy"</code></p>

<h3 id="ruby-throated-hummingbird-">Ruby-throated Hummingbird 🔊</h3>

<p><a href="https://ebird.org/species/rthhum">eBird species page</a></p>

<p>While looking out the window at a bunny with my daughter, this hummingbird flew right to the fuchsia baskets above us. As soon as my brain registered what this was, my phone alerted me of its first hummingbird detection!</p>

<p>In this clip, you can hear the hummingbird’s fast chirping and wings buzzing around the 00:09 mark. 🪽</p>

<!-- Method to implement AMP-Video. -->

<amp-video height="420" width="700" poster="/assets/files/2025/05/2025-05-24_07-50-42_Ruby-throated_Hummingbird.png" layout="responsive" controls="">
  <div fallback="">
    Your browser doesn't support HTML5 video
  </div>
  <source type="video/mp4" src="/assets/files/2025/05/2025-05-24_07-50-42_Ruby-throated_Hummingbird.mp4"></source>
</amp-video>

<p><code class="language-plaintext highlighter-rouge">bird-video.sh -i ~/Downloads/91238.mp4 -b true -d 11 -w "Clear Sky"</code></p>

<h3 id="black-throated-green-warbler-">Black-throated Green Warbler 🔊</h3>

<p><a href="https://ebird.org/species/btnwar">eBird species page</a></p>

<p>This crazy bird has such a unique advertising song. It sounds quite robotic. 🤖</p>

<!-- Method to implement AMP-Video. -->

<amp-video height="420" width="700" poster="/assets/files/2025/05/2025-05-07_07-18-50_Black-throated_Green_Warbler.png" layout="responsive" controls="">
  <div fallback="">
    Your browser doesn't support HTML5 video
  </div>
  <source type="video/mp4" src="/assets/files/2025/05/2025-05-07_07-18-50_Black-throated_Green_Warbler.mp4"></source>
</amp-video>

<p><code class="language-plaintext highlighter-rouge">bird-video.sh -i ~/Downloads/66671.mp4 -b true -m 4 -d 4 -w "Cloudy"</code></p>

<h3 id="red-tailed-hawk-">Red-tailed Hawk 🔊</h3>

<p><a href="https://ebird.org/species/rethaw">eBird species page</a></p>

<p>The iconic red-tailed hawk. This call is infamous in movies and TV shows. Often misrepresented as an eagle. 🦅</p>

<!-- Method to implement AMP-Video. -->

<amp-video height="420" width="700" poster="/assets/files/2025/05/2025-04-10_14-23-48_Red-tailed_Hawk.png" layout="responsive" controls="">
  <div fallback="">
    Your browser doesn't support HTML5 video
  </div>
  <source type="video/mp4" src="/assets/files/2025/05/2025-04-10_14-23-48_Red-tailed_Hawk.mp4"></source>
</amp-video>

<p><code class="language-plaintext highlighter-rouge">bird-video.sh -i ~/Downloads/24112.mp4 -b true -d 7 -w "Cloudy"</code></p>

<h3 id="osprey-duet-">Osprey Duet 🔊</h3>

<p><a href="https://ebird.org/species/osprey">eBird species page</a></p>

<p>While pushing my kids on the swing, I had these two Ospreys fly over me, calling back and forth. 🔊</p>

<!-- Method to implement AMP-Video. -->

<amp-video height="420" width="700" poster="/assets/files/2025/05/2025-03-29_11-07-07_Osprey.png" layout="responsive" controls="">
  <div fallback="">
    Your browser doesn't support HTML5 video
  </div>
  <source type="video/mp4" src="/assets/files/2025/05/2025-03-29_11-07-07_Osprey.mp4"></source>
</amp-video>

<p><code class="language-plaintext highlighter-rouge">bird-video.sh -i ~/Downloads/7045.mp4 -b true -m 5 -d 6 -w "Clear Sky" -s "Osprey" -u "Duet"</code></p>

<h2 id="cool-encounters">Cool Encounters</h2>

<p>I wanted to share some extra pictures of birds I have encountered. Two of them owe credit to BirdNET-Go!</p>

<p>The yellow-rumped warbler was the first bird detection in BirdNET-Go that I didn’t recognize as they only show up here during their migration. BirdNET-Go helped me figure out when I might hear them based on my previous detections. With a little bit of patience, I was able to spot one in my backyard. These little guys are fun to watch flit around the trees when the sun peeks through the clouds.</p>

<p><amp-img src="/assets/img/2025/05/yerwar.jpg" alt="Yellow-rumped warbler" width="800" height="602" layout="responsive"><noscript><img src="/assets/img/2025/05/yerwar.jpg" alt="Yellow-rumped warbler" width="800" height="602"></noscript></amp-img><em>A <a href="https://ebird.org/species/yerwar">Yellow-rumped warbler</a> in my backyard. Any guesses as to why it’s called that?</em></p>

<p>Next, I wasn’t expecting to see a mature male wild turkey in my backyard this spring. We’ve seen a few flocks over the years, but they always seem to be missing a mature male. Anyway, BirdNET-Go keyed me in that a wild turkey had been detected two days in a row. On the third day, I kept my eyes peeled and was rewarded with this lovely shot of its iridescent feathers. That was the last time I detected one.</p>

<p><amp-img src="/assets/img/2025/05/wiltur.jpg" alt="Wild turkey" width="800" height="602" layout="responsive"><noscript><img src="/assets/img/2025/05/wiltur.jpg" alt="Wild turkey" width="800" height="602"></noscript></amp-img><em>A <a href="https://ebird.org/species/wiltur">Wild turkey</a> in my backyard. The sun hit this bird’s iridescent feathers perfectly.</em></p>

<p>Last, there was a pair of Barred Owls that would nest around my parents’ house growing up circa 2009. Obviously, BirdNET-Go didn’t detect this one. But it was really cool hearing them at dusk and throughout the night. It was a fun memory I wanted to share.</p>

<p><amp-img src="/assets/img/2025/05/brdowl.jpg" alt="Barred owl" width="800" height="532" layout="responsive"><noscript><img src="/assets/img/2025/05/brdowl.jpg" alt="Barred owl" width="800" height="532"></noscript></amp-img><em>A <a href="https://ebird.org/species/brdowl">Barred owl</a> in my parents’ backyard circa 2009.</em></p>

<h2 id="future-plans">Future Plans</h2>

<p>A cool idea that won’t leave my head is that someday I’d like to be able to recreate a real-time ambient bird soundscape based on my detections in BirdNET-Go.</p>

<p>The thought is that maybe I’ve moved away from my current home, or I want to relive the experience of hearing the birds in my area. I can pair the timestamped database detections with random regional audio submissions on a site like <a href="https://ebird.org/">eBird</a>. Together, they could be used to recreate a <em>similar</em> real-time ambient bird soundscape that I’ve already experienced.</p>

<p>It will be interesting to see how my memories of birds change, and if I can use that to anchor me back to a time like this. I think it would be a fun project to work on in the distant future.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Listening to birds is fun. Birdwatching is a joy. Tune in to the sounds around you and it might make things a little brighter. 🐦‍🔥</p>

<p><amp-img src="/assets/img/2025/05/birdwatching_1.jpg" alt="Libbie and Kyle spotting an Eastern Bluebird at the park" width="800" height="600" layout="responsive"><noscript><img src="/assets/img/2025/05/birdwatching_1.jpg" alt="Libbie and Kyle spotting an Eastern Bluebird at the park" width="800" height="600"></noscript></amp-img><em>Libbie and Kyle spotting an <a href="https://ebird.org/species/easblu">Eastern Bluebird</a> at the park</em></p>


  </article>
</main>


<a href="/blog/2025/05/backyard-bird-tracking-with-ai/" class="meta center">Comments are available on the full webpage.</a>


<!-- start footer -->
<footer class="content">
  <div class="flex-list">
  <ul>
  
    <li>
      <a href="https://www.linkedin.com/in/kyleniewiada/">LinkedIn</a>
    </li>
  
    <li>
      <a href="https://github.com/aav7fl">GitHub</a>
    </li>
  
    <li>
      <a href="https://bsky.app/profile/crypticcitrus.bsky.social">Bluesky</a>
    </li>
  
    <li>
      <a href="https://www.youtube.com/user/KyleNiewiada">YouTube</a>
    </li>
  
    <li>
      <a href="https://kyleniewiada.bandcamp.com/" rel="nofollow">BandCamp</a>
    </li>
  
    <li>
      <a href="/sitemap/">Sitemap</a>
    </li>
  
  </ul>
</div>

</footer>
<!-- end footer -->


</body>

</html>
