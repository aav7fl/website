<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#3d256d">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#3d256d">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="shortcut icon" href="/favicon.ico">
    
      
        <link rel="amphtml" href="https://www.kyleniewiada.org/amp/blog/2020/07/appliance-notifications-through-vibration-and-power/" data-proofer-ignore>
      
    

    <!-- Messy way to capture custom page title to replace SEO Tags -->
    
    
    <title>Using Vibrations and Power to Notify When My Washing Machine and Dryer Finish</title>
    <meta property="og:title" content="Using Vibrations and Power to Notify When My Washing Machine and Dryer Finish" />

    <!-- Come and get me RSS readers -->
    <link type="application/atom+xml" rel="alternate" href="https://www.kyleniewiada.org/feed.xml" title="Kyle Niewiada&apos;s Website" />

    <!-- Critical Stylesheet -->
    <style type="text/css">
      
      @font-face{font-family:"Open Sans";font-display:swap;font-style:normal;font-weight:300;src:local("Open Sans Light"),local("OpenSans-Light"),url("/assets/fonts/open-sans-v17-latin-300.woff2") format("woff2"),url("/assets/fonts/open-sans-v17-latin-300.woff") format("woff")}@font-face{font-family:"Open Sans";font-display:swap;font-style:normal;font-weight:400;src:local("Open Sans"),local("OpenSans"),url("/assets/fonts/open-sans-v17-latin-regular.woff2") format("woff2"),url("/assets/fonts/open-sans-v17-latin-regular.woff") format("woff")}@font-face{font-family:"Open Sans";font-display:swap;font-style:normal;font-weight:600;src:local("Open Sans Semibold"),local("OpenSans-Semibold"),url("/assets/fonts/open-sans-v17-latin-600.woff2") format("woff2"),url("/assets/fonts/open-sans-v17-latin-600.woff") format("woff")}.page-title{text-align:left;font-size:200%;line-height:1.2;font-weight:normal}@media(min-width: 600px){.page-title{font-size:250%}}@media(min-width: 1000px){.page-title{font-size:300%}}.meta{color:dimgray;font-weight:300;font-size:120%}@media(min-width: 600px){.meta{font-size:130%}}@media(min-width: 1000px){.meta{font-size:140%}}.sub-meta{color:dimgray;font-weight:300;font-size:100%}@media(min-width: 600px){.sub-meta{font-size:110%}}@media(min-width: 1000px){.sub-meta{font-size:120%}}a.meta{text-align:center;display:block}.title-meta{overflow:auto;color:dimgray;font-size:100%}h1,.h1,h2,.h2,h3,.h3,h4,.h4,h5,.h5,h6,.h6{margin:0 0 .5rem;font-weight:600}a{color:#3d256d}a:hover{color:hsl(260,49.3150684932%,13.6274509804%)}code,pre{border-radius:.2em;background-color:#f5f5f5;border:.1em solid #d3d3d3}code{padding:2px 4px;color:#902f74}pre{padding:16px;overflow-y:hidden}pre code{color:inherit;background-color:rgba(0,0,0,0);padding:0;border:0}h1 .octicon,h2 .octicon,h3 .octicon,h4 .octicon,h5 .octicon,h6 .octicon{visibility:hidden}h1:hover .octicon,h2:hover .octicon,h3:hover .octicon,h4:hover .octicon,h5:hover .octicon,h6:hover .octicon{visibility:visible}.octicon{fill:currentColor;padding:0;vertical-align:middle}body{margin:0}body,p,li,ul,input,textarea{font-size:1em;line-height:1.58;color:#111;font-family:"Open Sans",Helvetica,Arial,sans-serif;overflow-wrap:break-word}img,video,audio,iframe,object{max-width:100%}main{display:block}.line-separator{height:2px;background:#d3d3d3;margin-top:16px;margin-bottom:16px}.clearfix:after{content:"";display:block;clear:both}.content{max-width:700px;margin-right:auto;margin-left:auto;padding:0 16px}.content img{display:block;margin-left:auto;margin-right:auto}.content video{display:block;margin-left:auto;margin-right:auto}.no-list{list-style:none;padding-left:0;margin-left:0}.left{float:left}.right{float:right}.post-list li{margin-bottom:4em;position:relative}.post-list li:before{content:"";position:absolute;bottom:-2em;left:0;background:hsl(0,0%,90%);height:2px;width:60px}.post-list li a{text-decoration:none}.post-list li a:hover{text-decoration:underline}.post-list li .date{color:dimgray;font-size:.8em}.header{background-image:url("/assets/img/banner.svg");background-color:#3a3a3a;background-size:cover;background-position:center center;padding:0;height:auto;margin-bottom:16px}.header .navigation{background:#262626}.header .nav-container{max-width:1000px;margin:0 auto}@media(min-width: 600px){.header{min-height:10em;position:relative;margin-bottom:16px}}nav{height:70px;overflow:hidden}nav ul{margin:0;padding:0;list-style-type:none;max-height:140px;position:relative}nav ul .active{background:#3d256d}nav li{display:inline-block;padding:0}nav a{display:inline-block;padding:0 1em;color:#fff;text-decoration:none;white-space:nowrap;line-height:70px;height:70px}nav a:hover{color:#fff;background-color:#00b2d9}nav li:first-child{left:0;vertical-align:top;font-size:75%}nav li:first-child :hover{color:#fff;background-color:#262626}@media(min-width: 330px){nav li:first-child{font-size:100%}}@media(min-width: 400px){nav li:first-child{font-size:140%}}nav li:last-child{position:absolute;right:0;bottom:70px;background-image:linear-gradient(to right, rgba(38, 38, 38, 0) 0, #262626 2em);padding-left:3em}nav li:nth-last-child(2){display:none}nav#menu:target{height:auto;padding:0}nav#menu:target ul{max-height:none}nav#menu:target li{display:block}nav#menu:target a{display:block;background-color:hsla(0,0%,100%,.05)}nav#menu:target li:not(:first-child){margin-top:2px}nav#menu:target li:not(:first-child) a:hover{background-color:#00b2d9}nav#menu:target li:last-child{display:none}nav#menu:target li:nth-last-child(2){display:inline-block;position:absolute;top:0;right:0;margin:0;border-left:2px solid #262626;background:#3a3a3a}
      
    </style>

    <!-- Contain all special checks needed on AMP pages. Attempt to consolidate checks. -->


  
  <!-- Extract extra <title> tag. -->
  
  
  
  

  
  
  
  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->

<meta name="generator" content="Jekyll v4.4.1" />

<meta name="author" content="Kyle Niewiada" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How I notify and detect the completion of my washing machine and dryer through the use of a vibration sensor, NodeMCU, smart plug, and ESPHome." />
<meta property="og:description" content="How I notify and detect the completion of my washing machine and dryer through the use of a vibration sensor, NodeMCU, smart plug, and ESPHome." />
<link rel="canonical" href="https://www.kyleniewiada.org/blog/2020/07/appliance-notifications-through-vibration-and-power/" />
<meta property="og:url" content="https://www.kyleniewiada.org/blog/2020/07/appliance-notifications-through-vibration-and-power/" />
<meta property="og:site_name" content="Kyle Niewiada’s Website" />
<meta property="og:image" content="https://www.kyleniewiada.org/assets/img/2020/07/dryer_vibration_monitor.jpg" />
<meta property="og:image:height" content="600" />
<meta property="og:image:width" content="800" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-26T08:00:00-04:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.kyleniewiada.org/assets/img/2020/07/dryer_vibration_monitor.jpg" />
<meta property="twitter:title" content="Using Vibrations and Power to Notify When My Washing Machine and Dryer Finish" />
<meta name="twitter:site" content="@CrypticCitrus" />
<meta name="twitter:creator" content="@CrypticCitrus" />
<meta property="fb:app_id" content="137961485759" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kyle Niewiada"},"dateModified":"2020-07-26T08:00:00-04:00","datePublished":"2020-07-26T08:00:00-04:00","description":"How I notify and detect the completion of my washing machine and dryer through the use of a vibration sensor, NodeMCU, smart plug, and ESPHome.","headline":"Using Vibrations and Power to Notify When My Washing Machine and Dryer Finish","image":{"height":600,"width":800,"url":"https://www.kyleniewiada.org/assets/img/2020/07/dryer_vibration_monitor.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.kyleniewiada.org/blog/2020/07/appliance-notifications-through-vibration-and-power/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://www.kyleniewiada.org/assets/img/logo.png"},"name":"Kyle Niewiada"},"url":"https://www.kyleniewiada.org/blog/2020/07/appliance-notifications-through-vibration-and-power/"}</script>
<!-- End Jekyll SEO tag -->

  



     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZP46JK222K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZP46JK222K');
</script> 
</head>


  <body>
  <!-- start header -->
<header class="header">
  <div class="navigation">
    <div class="nav-container">
      <nav id="menu">
        <ul class="menu-closed">
          
            
            <li class="normal"><a href="/">Kyle Niewiada</a></li>
          
            
            <li class="normal"><a href="/">Home</a></li>
          
            
            <li class="normal"><a href="/about/">About</a></li>
          
            
            <li class="normal"><a href="/archive/">Archive</a></li>
          
            
            <li class="normal"><a href="/contact/">Contact</a></li>
          
            
            <li class="normal"><a href="/resume/">Résumé</a></li>
          
          <li><a href="#">&#215; Close menu</a></li>
          <li><a href="#menu">&#9776; Menu</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>
<!-- end header -->

    <main class="content">
    <!-- lazy way to hide page title on blog posts -->
    

    <article>
  <header>
    <h1 class="page-title">Using Vibrations and Power to Notify When My Washing Machine and Dryer Finish</h1>

    <h2 class="meta">Kyle Niewiada on July 26, 2020</h2>

    <h3 class="meta">
      
      7 Minute Read
       | Small project</h3>
  </header>

  
  <h4 class="sub-meta">Updated on May 29, 2025</h4>
    

  
  <img src="/assets/img/2020/07/dryer_vibration_monitor.jpg" alt="NodeMCU board with SW-420 vibration sensor attached" />
  

  <div class="line-separator"></div>

  <p>My washing machine and dryer do not have an audible notification upon completion. When they finish they go silent 🔇. Because I live in a small space, I usually shut the door to the laundry room to reduce noise leakage in the main living area. On more than one occasion I have missed the end of the washer/dryer cycle because other ambient noises mask them. Rather than letting the clothes wrinkle up in the dryer or stay forgotten overnight in the washer, I would rather receive an audible alert upon a cycle completion.</p>

<p>The process of detecting the completion state of each appliance is its own task.</p>
<h2 id="-identifying-the-washing-machine-state">
  
  
    🧼 Identifying the Washing Machine State <a href="#-identifying-the-washing-machine-state" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h2>
    

<p>This one is easy. To detect the running state of the washing machine I need to monitor the power consumption on the standard wall plug.</p>

<p>In my last blog post I wrote about how I <a href="/blog/2020/07/replacing-z-wave-with-esphome/">deployed a handful of ESPHome smart plugs</a>. One of those plugs became a dedicated device to monitoring the power consumption of the washing machine. After running one cycle to see a baseline power usage, I was able to determine that at no point during any cycle does the washing machine drop below 3 W of power consumption.</p>

<p>Since my plug is running ESPHome, I just need to add a new <code class="language-plaintext highlighter-rouge">binary_sensor</code> to the device based on the plug’s power consumption.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">binary_sensor</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">template</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Running"</span>
    <span class="na">filters</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">delayed_off</span><span class="pi">:</span> <span class="s">15s</span>
    <span class="na">lambda</span><span class="pi">:</span> <span class="pi">|-</span>
      <span class="s">if (isnan(id(power).state)) {</span>
        <span class="s">return {};</span>
      <span class="s">} else if (id(power).state &gt;= 2) {</span>
        <span class="s">// Running</span>
        <span class="s">return true;</span>
      <span class="s">} else {</span>
        <span class="s">// Not running</span>
        <span class="s">return false;</span>
      <span class="s">}    </span>
</code></pre></div></div>
<h2 id="️identifying-the-dryer-state">
  
  
    ♨️Identifying the Dryer State <a href="#️identifying-the-dryer-state" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h2>
    

<blockquote>
  <p>Update (2020-09-20): After a month of using the vibration sensor with the dryer outlined below, I decided to switch to using a clamp style split phase energy meter. If you’re interested in my current monitoring method, <a href="/blog/2020/09/dryer-notification-addendum/">you can read about my post here</a>.</p>
</blockquote>

<p>Tracking the state of the dryer is a bit trickier. Since the dryer is connected to a 240V outlet, it essentially eliminates any reasonably priced smart plug.</p>

<p>This left me with four options (that I could come up with):</p>

<ol>
  <li>Open the dryer and hook up a CT clamp (magnetic induction sensor) to the 240V hot wire</li>
  <li>Open the dryer and connect a NodeMCU sensor input to a nonlethal connector on the main circuit board</li>
  <li>Throw a wireless sensor on the drum and track when it stops moving (or a handful of nickels so I can hear it better <code class="language-plaintext highlighter-rouge">/s</code>)</li>
  <li>Mount a vibration sensor to the side of the dryer and detect when the dryer stops shaking</li>
</ol>
<h3 id="reviewing-dryer-status-options">
  
  
    Reviewing Dryer Status Options <a href="#reviewing-dryer-status-options" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h3>
    

<p>I chose to use option 4, the vibration sensor. Let us walk through each idea above to figure out why I went with that solution.</p>
<h4 id="1-open-the-dryer-and-attach-a-ct-clamp">
  
  
    1. Open the Dryer and Attach a CT Clamp <a href="#1-open-the-dryer-and-attach-a-ct-clamp" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h4>
    

<p>Originally I thought using a CT clamp was going to be a good idea. In the end I opted against it. Ordering a CT clamp and another board to read data from it would require more parts that I didn’t feel like purchasing. I am also not too comfortable working around devices that are running 240V. I am sure everything would have been fine considering the CT clamp is a passive sensor, but the added costs caused me to choose a different option. I might revisit this option someday.</p>
<h4 id="2-connecting-a-nodemcu-to-the-dryer-main-circuit-board">
  
  
    2. Connecting a NodeMCU to the Dryer Main Circuit Board <a href="#2-connecting-a-nodemcu-to-the-dryer-main-circuit-board" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h4>
    

<p>This was another reasonable idea because it is very device specific. Because I can’t easily replicate this behavior across all dryers, I ruled it out early on.</p>

<p>My dryer does not have a digital display. In fact, it does not even have a light for the inside drum when you open the door. It is lacking quite a few features. The dryer strongly follows the “keep it stupid simple” policy.</p>

<p>If I were to connect a NodeMCU to the main circuit board, I would have to spend time figuring out which leads to run a sensor to. This is probably the clean approach, but I wanted to avoid a solution that was device specific. Whatever solution I came up with needed to be generic for anyone to replicate in the future.</p>

<p>Keeping it generic also reduces the “re-factoring in real life” when the dryer gets replaced someday…<em>maybe</em>.</p>
<h4 id="3-using-a-wireless-sensor-on-the-drum-to-track-gyro-movement">
  
  
    3. Using a Wireless Sensor on the Drum to Track Gyro Movement <a href="#3-using-a-wireless-sensor-on-the-drum-to-track-gyro-movement" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h4>
    

<p>Truthfully, I am not that interested in using a low powered wireless sensor. This is just another device to charge and keep track of. If I have to think about it and manage it, it’s not really automated anymore.</p>
<h4 id="4-using-a-vibration-sensor">
  
  
    4. Using a Vibration Sensor <a href="#4-using-a-vibration-sensor" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h4>
    

<p>The last solution I am going to describe is using a vibration sensor to track the completion of the dryer. While researching ways that people have tracked their dryer status, one of the fun ways mentioned has been using a vibration sensor.</p>

<p>It is a simple concept. You connect a vibration sensor to a NodeMCU. When the vibration sensor detects movement the sensor signal being sent to the NodeMCU will change. If the vibration is stopped for long enough, one can infer that the dryer has completed its cycle.</p>

<p>I really like this idea because it is generously cheap and generic enough to work on most dryers. The only exceptions I can think of are for stacked units, a <em>really</em> good dryer bearing that doesn’t vibrate, or an unstable room that shakes a lot.</p>

<p>The sensor most people use for their dryer detection is the <code class="language-plaintext highlighter-rouge">SW-420 vibration sensor</code>. I ended up getting a 5-pack for $7.</p>

<p><img src="/assets/img/2020/07/dryer_vibration_monitor.jpg" alt="NodeMCU board with SW-420 vibration sensor attached" /><em>NodeMCU with SW-420 vibration sensor attached</em></p>
<h3 id="configuring-esphome-with-the-vibration-sensor">
  
  
    Configuring ESPHome with the Vibration Sensor <a href="#configuring-esphome-with-the-vibration-sensor" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h3>
    

<p>When I see most people use a vibration sensor to track the dryer status, they consider the dryer as <code class="language-plaintext highlighter-rouge">running</code> when the vibration sensor is <em>first</em> triggered. After <code class="language-plaintext highlighter-rouge">15s</code> without any re-triggers, they mark the dryer status as <code class="language-plaintext highlighter-rouge">done</code>.</p>

<p>This might be fine for people that have their dryer in a closet hidden in the back room. For me, the dryer is in a high traffic room. This means it is easy to bump the dryer sensor and create a false positive event. Other concerns include large thunder strikes and the nearby semi-trucks from a busy road that are known to set off car alarms.</p>

<p>To avoid false positives, I decided to treat the vibration sensor like a <code class="language-plaintext highlighter-rouge">pulse counter</code>. I then take a <code class="language-plaintext highlighter-rouge">moving median window</code> of the <code class="language-plaintext highlighter-rouge">pulse counter</code> rate to eliminate any outliers that are not producing consistent vibration.</p>

<p>Adding a <code class="language-plaintext highlighter-rouge">moving median window</code> does decrease the reactivity of the dryer status by approximately 10-15s. But in turn it eliminates all false positives from inconsistent vibrations.</p>

<p>Here are the relevant changes in ESPHome I made to my NodeMCU chip that allow it to interpret the vibrations with a <code class="language-plaintext highlighter-rouge">moving median window</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sensors that the ESPHome unit is capable of reporting</span>
<span class="na">sensor</span><span class="pi">:</span>
    <span class="c1"># Handle a moving average of vibrations </span>
    <span class="c1"># Avoids `turning on` when bumping the dryer</span>
  <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">pulse_counter</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Vibration</span><span class="nv"> </span><span class="s">Pulse</span><span class="nv"> </span><span class="s">Rate"</span>
    <span class="na">internal</span><span class="pi">:</span> <span class="kc">false</span> <span class="c1"># It may be easier to expose this when setting up and testing</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s">vibration_pulse_rate</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">mdi:vibrate</span>
    <span class="na">update_interval</span><span class="pi">:</span> <span class="s">250ms</span> <span class="c1"># 4x a second</span>
    <span class="na">pin</span><span class="pi">:</span>
      <span class="na">number</span><span class="pi">:</span> <span class="s">GPIO15</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">INPUT</span>
    <span class="na">filters</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">median</span><span class="pi">:</span>
        <span class="na">window_size</span><span class="pi">:</span> <span class="m">61</span> <span class="c1"># ~15 second moving window</span>
        <span class="na">send_every</span><span class="pi">:</span> <span class="m">4</span> <span class="c1"># Every 1 second</span>
        <span class="na">send_first_at</span><span class="pi">:</span> <span class="s">3</span> 

<span class="c1"># SW-420 Vibration Sensor</span>
<span class="na">binary_sensor</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">template</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Running"</span>
    <span class="na">device_class</span><span class="pi">:</span> <span class="s">vibration</span>
    <span class="na">filters</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">delayed_on_off</span><span class="pi">:</span> <span class="s">120s</span> <span class="c1"># Avoid debounce shaking from washing machine in close proximity</span>
    <span class="na">lambda</span><span class="pi">:</span> <span class="pi">|-</span>
      <span class="s">if (id(vibration_pulse_rate).state &gt;= 240) {</span>
        <span class="s">// Dryer is running</span>
        <span class="s">return true;</span>
      <span class="s">} else {</span>
        <span class="s">// Dryer is off</span>
        <span class="s">return false;</span>
      <span class="s">}    </span>
</code></pre></div></div>

<p>I then create a <code class="language-plaintext highlighter-rouge">binary_sensor</code> from the <code class="language-plaintext highlighter-rouge">pulse_counter</code> sensor expose it to Home Assistant.</p>

<p>The <code class="language-plaintext highlighter-rouge">binary_sensor</code> helps obfuscates the of the raw <code class="language-plaintext highlighter-rouge">pulse counter</code> values that I do not need to send over the network. It also reduces the refactoring need in Home Assistant since the state will be determined entirely on the NodeMCU node.</p>

<p><img src="/assets/img/2020/07/dryer_monitor_installed.jpg" alt="Monitoring contraption attached to the side of a dryer" /><em>Dryer monitoring contraption installed</em></p>
<h2 id="notifications">
  
  
    Notifications <a href="#notifications" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h2>
    

<p>Finally, after I have captured the states of the washer and dryer inside Home Assistant, I can determine how I want to broadcast the notification upon completing the washing machine and dryer cycles.</p>

<p><img src="/assets/img/2020/07/node_red_cleaning_notifications.png" alt="Node-RED dashboard showing flow for washer and dryer notifications" /><em>Node-RED washer/dryer notification flow</em></p>

<p>In the flow above I am using Node-RED to create the automation handling the notification alert.</p>

<p>The top flow checks if the <code class="language-plaintext highlighter-rouge">washing machine</code> state changes from <code class="language-plaintext highlighter-rouge">on</code> -&gt; <code class="language-plaintext highlighter-rouge">off</code>.</p>

<p>The bottom flow checks if the <code class="language-plaintext highlighter-rouge">dryer</code> state changes from <code class="language-plaintext highlighter-rouge">on</code> -&gt; <code class="language-plaintext highlighter-rouge">off</code>.</p>

<p>If either of those two devices are complete, it will call service within Home Assistant to broadcast a notification to all Google Homes that the respective appliance is done running.</p>

<p>The catch is that I do not want any alerts to be sent out unless they are <em>actionable</em>. What I mean is that I do not wish to be notified if the washer is done but the dryer is still running. That is because there is nothing I can do. There is nowhere to put the wet clothes yet. You can see this modification in the top flow where I restrict notifications from being sent if the dryer is still running.</p>
<h2 id="conclusion">
  
  
    Conclusion <a href="#conclusion" aria-hidden="true" tabindex="-1"><svg class='octicon' viewBox='0 0 16 16' version='1.1' width='16' height='32' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg></a>
  
  
</h2>
    

<p>This is an automation that I have been dreaming about for a while but have not spent the time to examine all approaches until recently.</p>

<p>I feel content with my low-cost approach on each appliance and I admire the fact that they are mostly generic. This will allow me to continue using these methods in the future unless there are unforeseen changes.</p>

<p>I have a smart way to monitor the state of the washing machine and dryer. My system sends alerts only when they are actionable and reduces the downtime between each load. An automation that increases efficiency is a pleasant one.</p>

  <div class="line-separator"></div>

  <!-- POST NAVIGATION -->
<div class="post-nav">
  
    <a class="post-nav-link" href="/blog/2020/07/replacing-z-wave-with-esphome/">
    <div class="link-text previous">&laquo;&nbsp;Deploying ESPHome Smart Plugs to Replace Z-Wave</div>
    
      <img class="link-image" src="/assets/img/2020/07/sonoff_s31_plugs_disassembled.jpg" alt="Previous Article">
    
    </a>
  
  
    <a class="post-nav-link" href="/blog/2020/09/dryer-notification-addendum/">
    <div class="link-text next">Electric Dryer Monitoring with a CT Clamp&nbsp;&raquo;</div>
    
      <img class="link-image" src="/assets/img/2020/09/CircuitSetup_Split_Single_Phase_Energy_Meter.jpg" alt="Next Article">
    
    </a>
  
</div>

</article>


    
<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'kyleniewiada'; // required: replace example with your forum shortname
  var disqus_identifier = "/blog/2020/07/appliance-notifications-through-vibration-and-power/";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    </main>
  <!-- start footer -->
<footer class="content">
  <div class="flex-list">
  <ul>
  
    <li>
      <a href="https://www.linkedin.com/in/kyleniewiada/" >LinkedIn</a>
    </li>
  
    <li>
      <a href="https://github.com/aav7fl" >GitHub</a>
    </li>
  
    <li>
      <a href="https://bsky.app/profile/crypticcitrus.bsky.social" >Bluesky</a>
    </li>
  
    <li>
      <a href="https://www.youtube.com/user/KyleNiewiada" >YouTube</a>
    </li>
  
    <li>
      <a href="https://kyleniewiada.bandcamp.com/" rel='nofollow'>BandCamp</a>
    </li>
  
    <li>
      <a href="/sitemap/" >Sitemap</a>
    </li>
  
  </ul>
</div>

</footer>
<!-- start noncritical style -->
<link rel="preload" href="/assets/css/noncritical.css" as="style" onload="this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="/assets/css/noncritical.css"></noscript>
<script>
  /*loadCss*/
  !function(w){"use strict";var loadCSS=function(href,before,media){function ready(cb){return doc.body?cb():void setTimeout(function(){ready(cb)})}function loadCB(){ss.addEventListener&&ss.removeEventListener("load",loadCB),ss.media=media||"all"}var ref,doc=w.document,ss=doc.createElement("link");if(before)ref=before;else{var refs=(doc.body||doc.getElementsByTagName("head")[0]).childNodes;ref=refs[refs.length-1]}var sheets=doc.styleSheets;ss.rel="stylesheet",ss.href=href,ss.media="only x",ready(function(){ref.parentNode.insertBefore(ss,before?ref:ref.nextSibling)});var onloadcssdefined=function(cb){for(var resolvedHref=ss.href,i=sheets.length;i--;)if(sheets[i].href===resolvedHref)return cb();setTimeout(function(){onloadcssdefined(cb)})};return ss.addEventListener&&ss.addEventListener("load",loadCB),ss.onloadcssdefined=onloadcssdefined,onloadcssdefined(loadCB),ss};"undefined"!=typeof exports?exports.loadCSS=loadCSS:w.loadCSS=loadCSS}("undefined"!=typeof global?global:this);

  /*link[rel=preload] polyfill*/
  !function(w){if(w.loadCSS){var rp=loadCSS.relpreload={};if(rp.support=function(){try{return w.document.createElement("link").relList.supports("preload")}catch(e){return!1}},rp.poly=function(){for(var links=w.document.getElementsByTagName("link"),i=0;i<links.length;i++){var link=links[i];"preload"===link.rel&&"style"===link.getAttribute("as")&&(w.loadCSS(link.href,link),link.rel=null)}},!rp.support()){rp.poly();var run=w.setInterval(rp.poly,300);w.addEventListener&&w.addEventListener("load",function(){w.clearInterval(run)}),w.attachEvent&&w.attachEvent("onload",function(){w.clearInterval(run)})}}}(this);
</script>
<!-- end noncritical style -->
<!-- end footer -->

  </body>
</html>
